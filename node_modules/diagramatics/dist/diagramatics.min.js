class t{constructor(t,e){this.x=t,this.y=e}add(e){return new t(this.x+e.x,this.y+e.y)}sub(e){return new t(this.x-e.x,this.y-e.y)}scale(e){return new t(this.x*e,this.y*e)}mul(e){return new t(this.x*e.x,this.y*e.y)}rotate(e){let n=this.x*Math.cos(e)-this.y*Math.sin(e),r=this.x*Math.sin(e)+this.y*Math.cos(e);return new t(n,r)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}equals(t){return this.x==t.x&&this.y==t.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}length_sq(){return this.x*this.x+this.y*this.y}angle(){return Math.atan2(this.y,this.x)}normalize(){let e=this.length();return new t(this.x/e,this.y/e)}copy(){return new t(this.x,this.y)}apply(t){return t(this.copy())}}function e(e,n){return new t(e,n)}function n(e){return new t(Math.cos(e),Math.sin(e))}class r{static translate(t){return e=>e.add(t)}static rotate(t,e){return n=>n.sub(e).rotate(t).add(e)}static scale(t,e){return n=>n.sub(e).mul(t).add(e)}static reflect_over_point(t){return e=>e.sub(t).rotate(Math.PI).add(t)}static reflect_over_line(t,e){let n=e.sub(t).rotate(Math.PI/2).normalize();return e=>{let r=n.dot(e.sub(t));return e.sub(n.scale(2*r))}}static skewX(e,n){return r=>{let i=r.x+(n-r.y)*Math.tan(e);return new t(i,r.y)}}static skewY(e,n){return r=>{let i=r.y+(n-r.x)*Math.tan(e);return new t(r.x,i)}}}var i,s,a;!function(t){t.TEXT="TEXT",t.OPEN_TAG="OPEN_TAG",t.CLOSE_TAG="CLOSE_TAG",t.EOF="EOF"}(i||(i={}));class l{static parse_tag_content(t){if("/"===t[0]){let e=t.substring(1);return{type:i.CLOSE_TAG,attributes:{_tag_name:e}}}let e=t.indexOf(" "),n=t.indexOf("=");if(-1===e&&-1===n)return{type:i.OPEN_TAG,attributes:{_tag_name:t}};if(-1===e&&n>0){let e=t.substring(0,n),r=t.substring(n+1),s={_tag_name:e};return s[e]=r,{type:i.OPEN_TAG,attributes:s}}throw new Error("Unimplemented")}static parse(t){let e=[],n=0,r=t.length;for(;n<r;){let r=t.indexOf("[",n);if(-1===r){e.push({type:i.TEXT,attributes:{_text:t.substring(n)}});break}r>n&&e.push({type:i.TEXT,attributes:{_text:t.substring(n,r)}});let s=t.indexOf("]",r),a=t.indexOf("[",r+1);if(a>0&&a<s)return null;if(-1===s)return null;let o=t.substring(r+1,s);e.push(l.parse_tag_content(o)),n=s+1}return e}}class o{static from_BBCode(t,e="1em"){var n;let r=[],s=[],a=l.parse(t);if(null===a)return console.error("Invalid BBCode"),[];for(let t of a)switch(t.type){case i.OPEN_TAG:if("br"===t.attributes._tag_name){const t=null!==(n=o.build_style(s)["_line-height"])&&void 0!==n?n:e;r.push({text:"\n",style:{dy:t}});break}s.push(t.attributes);break;case i.CLOSE_TAG:if(0===s.length)return console.error("Invalid BBCode"),[];if(s[s.length-1]._tag_name!==t.attributes._tag_name)return console.error("Invalid BBCode"),[];s.pop();break;case i.TEXT:{let e=o.build_style(s);r.push({text:t.attributes._text,style:e})}}return r}static split_tspans_by_words(t){let e=[];for(let n of t){let t=n.text.split(" ");for(let e=0;e<t.length-1;e++)t[e]+=" ";for(let r of t)e.push({text:r,style:JSON.parse(JSON.stringify(n.style))})}return e}static build_style(t){let e={};for(let n of t)switch(n._tag_name){case"b":e["font-weight"]="bold";break;case"i":e["font-style"]="italic";break;case"color":e.fill=n.color;break;case"size":e["font-size"]=n.size;break;case"dx":e.dx=n.dx;break;case"dy":e.dy=n.dy;break;case"font":e["font-family"]=n.font;break;case"var":e.textvar=!0;break;case"tag":e.tag=n.tag;break;case"lineheight":e["_line-height"]=n.lineheight;break;case"sup":e["baseline-shift"]="super",e["font-size-scale-factor"]=.7,e["is-prev-word"]=!0;break;case"sub":e["baseline-shift"]="-20%",e["font-size-scale-factor"]=.7,e["is-prev-word"]=!0}return e}}!function(t){t.EMPTY="empty",t.LINE="line",t.CIRCLE="circle",t.TEXTVAR="textvar",t.ROW_="row_",t.COL_="col_",t.ARROW_LINE="arrow_line",t.ARROW_HEAD="arrow_head",t.TABLE="table",t.CONTAIN_TABLE="contain_table",t.TABLE_CELL="table_cell",t.TABLE_CONTENT="table_content",t.EMPTY_CELL="empty_cell",t.GRAPH_AXIS="graph_axis_line",t.GRAPH_TICK="graph_tick",t.GRAPH_TICK_LABEL="graph_tick_label",t.GRAPH_GRID="graph_grid"}(s||(s={})),function(t){t.Polygon="polygon",t.Curve="curve",t.Text="text",t.Image="image",t.Diagram="diagram",t.MultilineText="multilinetext"}(a||(a={}));const h="16";class c{constructor(e,n={}){this.children=[],this.path=void 0,this.origin=new t(0,0),this.style={},this.textdata={},this.multilinedata={},this.imgdata={},this.mutable=!1,this.tags=[],this._bbox_cache=void 0,this.type=e,this.path=n.path,n.children&&(this.children=n.children),n.textdata&&(this.textdata=n.textdata),n.imgdata&&(this.imgdata=n.imgdata),n.tags&&(this.tags=n.tags),n.multilinedata&&(this.multilinedata=n.multilinedata)}mut(){this.mutable=!0,null!=this.path&&(this.path.mutable=!0);for(let t=0;t<this.children.length;t++)this.children[t].mut();return this}mut_parent_only(){return this.mutable=!0,null!=this.path&&(this.path.mutable=!0),this}immut(){let t=this.copy();t.mutable=!1,null!=this.path&&(this.path.mutable=!1);for(let e=0;e<t.children.length;e++)t.children[e].immut();return t}static deep_setPrototypeOf(e){Object.setPrototypeOf(e,c.prototype);let n=e;n.origin=Object.setPrototypeOf(n.origin,t.prototype);for(let t=0;t<n.children.length;t++)c.deep_setPrototypeOf(n.children[t]);null!=n.path&&(Object.setPrototypeOf(n.path,u.prototype),n.path=n.path.copy()),null!=n._bbox_cache&&2==n._bbox_cache.length&&(Object.setPrototypeOf(n._bbox_cache[0],t.prototype),Object.setPrototypeOf(n._bbox_cache[1],t.prototype))}copy(){let t=JSON.parse(JSON.stringify(this));return c.deep_setPrototypeOf(t),t}copy_if_not_mutable(){return this.mutable?this:this.copy()}append_tags(t){let e=this.copy_if_not_mutable();Array.isArray(t)||(t=[t]);for(let n of t)e.tags.includes(n)||e.tags.push(n);return e}remove_tags(t){let e=this.copy_if_not_mutable();return e.tags=e.tags.filter((e=>!t.includes(e))),e}reset_tags(){let t=this.copy_if_not_mutable();return t.tags=[],t}contain_tag(t){return this.tags.includes(t)}contain_all_tags(t){for(let e of t)if(!this.tags.includes(e))return!1;return!0}collect_children(){let t=[];if(this.type==a.Diagram)for(let e of this.children)t=t.concat(e.collect_children());else t.push(this);return t}flatten(){let t=this.copy_if_not_mutable();return t.children=t.collect_children(),t}apply(t){return t(this.copy_if_not_mutable())}apply_recursive(t){let e=this.copy_if_not_mutable();e=t(e);for(let n=0;n<e.children.length;n++)e.children[n]=e.children[n].apply_recursive(t);return e}apply_to_tagged_recursive(t,e){Array.isArray(t)||(t=[t]);let n=this.copy_if_not_mutable();n.contain_all_tags(t)&&(n=e(n));for(let r=0;r<n.children.length;r++)n.children[r]=n.children[r].apply_to_tagged_recursive(t,e);return n}get_tagged_elements(t){Array.isArray(t)||(t=[t]);let e=[];this.contain_all_tags(t)&&e.push(this.copy_if_not_mutable());for(let n=0;n<this.children.length;n++)e=e.concat(this.children[n].get_tagged_elements(t));return e}combine(...t){return d(this,...t)}to_curve(){let t=this.copy_if_not_mutable();if(t.type==a.Polygon)t.type=a.Curve;else if(t.type==a.Diagram)for(let e=0;e<t.children.length;e++)t.children[e]=t.children[e].to_curve();return t}to_polygon(){let t=this.copy_if_not_mutable();if(t.type==a.Curve)t.type=a.Polygon;else if(t.type==a.Diagram)for(let e=0;e<t.children.length;e++)t.children[e]=t.children[e].to_polygon();return t}add_points(t){let e=this.copy_if_not_mutable();if(e.type==a.Polygon||e.type==a.Curve){if(null==e.path)throw new Error(this.type+" must have a path");e.path=e.path.add_points(t)}else if(e.type==a.Diagram){let n=e.children[e.children.length-1];e.children[e.children.length-1]=n.add_points(t)}return e}update_style(t,e,n){let r=this.copy_if_not_mutable();if(null==n?void 0:n.includes(r.type))return r;if(r.type==a.Polygon||r.type==a.Curve||r.type==a.Text||r.type==a.Image||r.type==a.MultilineText)r.style[t]=e;else{if(r.type!=a.Diagram)throw new Error("Unreachable, unknown diagram type : "+r.type);for(let i=0;i<r.children.length;i++)r.children[i]=r.children[i].update_style(t,e,n)}return r}clone_style_from(t){return this.apply_recursive((e=>(e.style=Object.assign({},t.style),e)))}fill(t){return this.update_style("fill",t,[a.Text])}stroke(t){return this.update_style("stroke",t,[a.Text])}opacity(t){return this.update_style("opacity",t.toString())}strokewidth(t){return this.update_style("stroke-width",t.toString(),[a.Text])}strokelinecap(t){return this.update_style("stroke-linecap",t)}strokelinejoin(t){return this.update_style("stroke-linejoin",t)}strokedasharray(t){return this.update_style("stroke-dasharray",t.join(","))}vectoreffect(t){return this.update_style("vector-effect",t)}filter(t){return this.update_style("filter",`url(#${t})`)}textfill(t){return this.update_style("fill",t,[a.Polygon,a.Curve])}textstroke(t){return this.update_style("stroke",t,[a.Polygon,a.Curve])}textstrokewidth(t){return this.update_style("stroke-width",t.toString(),[a.Polygon,a.Curve])}update_textdata(t,e){let n=this.copy_if_not_mutable();if(n.type==a.Text||n.type==a.MultilineText)n.textdata[t]=e;else if(n.type==a.Diagram)for(let r=0;r<n.children.length;r++)n.children[r]=n.children[r].update_textdata(t,e);else if(n.type!=a.Polygon&&n.type!=a.Curve)throw new Error("Unreachable, unknown diagram type : "+n.type);return n}fontfamily(t){return this.update_textdata("font-family",t)}fontstyle(t){return this.update_textdata("font-style",t)}fontsize(t){return this.update_textdata("font-size",t.toString())}fontweight(t){return this.update_textdata("font-weight",t.toString())}fontscale(t){return this.update_textdata("font-scale",t.toString())}textanchor(t){return this.update_textdata("text-anchor",t)}textdy(t){return this.update_textdata("dy",t)}textangle(t){return this.update_textdata("angle",t.toString())}text_tovar(){let t=this.copy_if_not_mutable();if(t.type==a.Text)t=t.append_tags(s.TEXTVAR);else if(t.type==a.Diagram)for(let e=0;e<t.children.length;e++)t.children[e]=t.children[e].text_tovar();return t}text_totext(){let t=this.copy_if_not_mutable();if(t.type==a.Text)t=t.remove_tags("textvar");else if(t.type==a.Diagram)for(let e=0;e<t.children.length;e++)t.children[e]=t.children[e].text_totext();return t}bounding_box(){if(null!=this._bbox_cache)return this._bbox_cache;let e=1/0,n=1/0,r=-1/0,i=-1/0;if(this.type==a.Diagram){for(let t=0;t<this.children.length;t++){let s=this.children[t],[a,l]=s.bounding_box();e=Math.min(e,a.x),n=Math.min(n,a.y),r=Math.max(r,l.x),i=Math.max(i,l.y)}const s=[new t(e,n),new t(r,i)];return this._bbox_cache=s,s}if(this.type==a.Curve||this.type==a.Polygon||this.type==a.Image){if(null==this.path)throw new Error(this.type+" must have a path");for(let t=0;t<this.path.points.length;t++){let s=this.path.points[t];e=Math.min(e,s.x),n=Math.min(n,s.y),r=Math.max(r,s.x),i=Math.max(i,s.y)}const s=[new t(e,n),new t(r,i)];return this._bbox_cache=s,s}if(this.type==a.Text||this.type==a.MultilineText){const t=[this.origin.copy(),this.origin.copy()];return this._bbox_cache=t,t}throw new Error("Unreachable, unknown diagram type : "+this.type)}transform(t){let e=this.copy_if_not_mutable();e._bbox_cache=void 0;for(let n=0;n<e.children.length;n++)e.children[n]=e.children[n].transform(t);return null!=e.path&&(e.path=e.path.transform(t)),e.origin=t(e.origin),e}translate(t){const e=this._bbox_cache,n=this.transform(r.translate(t));return null!=e&&(n._bbox_cache=e.map((e=>r.translate(t)(e)))),n}position(e=new t(0,0)){let n=e.sub(this.origin);return this.translate(n)}rotate(t,e=void 0){return null==e&&(e=this.origin),this.transform(r.rotate(t,e))}scale(e,n){return null==n&&(n=this.origin),"number"==typeof e&&(e=new t(e,e)),this.transform(r.scale(e,n))}scaletext(t){return this.apply_recursive((e=>{switch(e.type){case a.Text:{let n=parseFloat(e.textdata["font-size"]||h),r=e.copy_if_not_mutable();return r.textdata["font-size"]=(n*t).toString(),r}case a.MultilineText:{let n=e.copy_if_not_mutable();return n.multilinedata["scale-factor"]=(n.multilinedata["scale-factor"]||1)*t,n}default:return e}}))}skewX(t,e){return null==e&&(e=this.origin),this.transform(r.skewX(t,e.y))}skewY(t,e){return null==e&&(e=this.origin),this.transform(r.skewY(t,e.x))}reflect_over_point(t){return this.transform(r.reflect_over_point(t))}reflect_over_line(t,e){return this.transform(r.reflect_over_line(t,e))}reflect(t,e){if(null==t&&null==e)return this.reflect_over_point(this.origin);if(null!=t&&null==e)return this.reflect_over_point(t);if(null!=t&&null!=e)return this.reflect_over_line(t,e);throw new Error("Unreachable")}vflip(e){return null==e&&(e=this.origin.y),this.reflect(new t(0,e),new t(1,e))}hflip(e){return null==e&&(e=this.origin.x),this.reflect(new t(e,0),new t(e,1))}get_anchor(e){let[n,r]=this.bounding_box(),i=n.x,s=n.y,a=r.x,l=r.y,o=(i+a)/2,h=(s+l)/2;switch(e){case"top-left":return new t(i,l);case"top-center":return new t(o,l);case"top-right":return new t(a,l);case"center-left":return new t(i,h);case"center-center":return new t(o,h);case"center-right":return new t(a,h);case"bottom-left":return new t(i,s);case"bottom-center":return new t(o,s);case"bottom-right":return new t(a,s);default:throw new Error("Unknown anchor "+e)}}move_origin(e){let n=this.copy_if_not_mutable();return n.origin=e instanceof t?e:n.get_anchor(e),n}__move_origin_text(t){let e=this.copy_if_not_mutable(),n=function(t){switch(t){case"top-left":return{"text-anchor":"start",dy:"0.75em"};case"top-center":return{"text-anchor":"middle",dy:"0.75em"};case"top-right":return{"text-anchor":"end",dy:"0.75em"};case"center-left":return{"text-anchor":"start",dy:"0.25em"};case"center-center":return{"text-anchor":"middle",dy:"0.25em"};case"center-right":return{"text-anchor":"end",dy:"0.25em"};case"bottom-left":return{"text-anchor":"start",dy:"-0.25em"};case"bottom-center":return{"text-anchor":"middle",dy:"-0.25em"};case"bottom-right":return{"text-anchor":"end",dy:"-0.25em"};default:throw new Error("Unknown anchor "+t)}}(t);return e.textdata["text-anchor"]=n["text-anchor"],e.textdata.dy=n.dy,e}move_origin_text(t){let e=this.copy_if_not_mutable();if(this.type==a.Text||this.type==a.MultilineText)e=e.__move_origin_text(t);else if(this.type==a.Diagram)for(let n=0;n<e.children.length;n++)e.children[n]=e.children[n].move_origin_text(t);return e}path_length(){if(this.type==a.Diagram){let t=0;for(let e=0;e<this.children.length;e++)t+=this.children[e].path_length();return t}if(this.type==a.Curve||this.type==a.Polygon){if(null==this.path)throw new Error(this.type+" must have a path");return this.path.length()}throw new Error("Unreachable, unknown diagram type : "+this.type)}reverse_path(){var t;let e=this.copy_if_not_mutable();return e.path&&(e.path=null===(t=e.path)||void 0===t?void 0:t.reverse()),e}parametric_point(t,e){if(this.type==a.Diagram){let e=[],n=0;for(let t=0;t<this.children.length;t++)n+=this.children[t].path_length(),e.push(n);let r=n,i=e.map((t=>t/r));for(let e=0;e<i.length;e++)if(t<=i[e]){let n=e,r=0==e?0:i[e-1],s=(t-r)/(i[e]-r);return this.children[n].parametric_point(s)}throw Error("Unreachable")}if(this.type==a.Curve){if(null==this.path)throw new Error(this.type+" must have a path");return this.path.parametric_point(t,!1,e)}if(this.type==a.Polygon){if(null==this.path)throw new Error(this.type+" must have a path");return this.path.parametric_point(t,!0,e)}throw new Error("Unreachable, unknown diagram type : "+this.type)}debug_bbox(){let[e,n]=this.bounding_box(),r=f([new t(e.x,e.y),new t(n.x,e.y),new t(n.x,n.y),new t(e.x,n.y)]).apply((t=>t.fill("none").stroke("gray").strokedasharray([5,5]))),i=m("+").position(this.origin);return r.combine(i)}debug(t=!0){let e=t=>t.fill("none").stroke("red").strokedasharray([5,5]),n=t=>{let e=t.textfill("white").textstroke("white").textstrokewidth(5),n=t.fill("black");return e.combine(n)};if(this.type==a.Diagram)return this.debug_bbox();if(this.type==a.Text)return _(this.origin);if(this.type==a.Polygon||this.type==a.Curve||this.type==a.Image){let r=this.type==a.Polygon||a.Image?f:g,i=this.debug_bbox();if(null==this.path)throw new Error(this.type+" must have a path");let s=r(this.path.points).apply(e);if(0==t)return i.combine(s);let l,o=this.path.points,h=[],[c,u]=this.bounding_box(),d=Math.min(u.x-c.x,u.y-c.y)/10;for(let t=0;t<o.length;t++){(null==l?1/0:o[t].sub(l).length())<d||(h.push(m(t.toString()).position(o[t]).apply(n)),l=o[t])}return i.combine(s,...h)}throw new Error("Unreachable, unknown diagram type : "+this.type)}is_empty(){return this.contain_tag(s.EMPTY)}}class u{constructor(t){this.points=t,this.mutable=!1}copy(){let e=this.points.map((e=>new t(e.x,e.y)));return new u(e)}copy_if_not_mutable(){return this.mutable?this:this.copy()}reverse(){let t=this.copy_if_not_mutable();return t.points=t.points.reverse(),t}length(){let t=0;for(let e=1;e<this.points.length;e++)t+=this.points[e].sub(this.points[e-1]).length();return t}add_points(t){let e=this.copy_if_not_mutable();return e.points=e.points.concat(t),e}parametric_point(t,e=!1,n){let r=this.points;if(e&&(r=this.points.concat(this.points[0])),null==n){if(t<0||t>1)throw Error("t must be between 0 and 1");let n=[],i=0;for(let t=1;t<r.length;t++)i+=r[t].sub(r[t-1]).length(),n.push(i);let s=i,a=n.map((t=>t/s));for(let n=0;n<a.length;n++)if(t<=a[n]){let r=n,i=0==n?0:a[n-1],s=(t-i)/(a[n]-i);return this.parametric_point(s,e,r)}throw Error("Unreachable")}{if(n<0||n>r.length-1)throw Error("segment_index must be between 0 and n-1");let e=r[n],i=r[n+1].sub(e);return e.add(i.scale(t))}}transform(t){let e=this.copy_if_not_mutable();for(let n=0;n<e.points.length;n++)e.points[n]=t(e.points[n]);return e}}function d(...t){if(0==t.length)return _();let e=t.map((t=>t.copy_if_not_mutable())),n=!0;for(let t=0;t<e.length;t++)if(!e[t].mutable){n=!1;break}let r=new c(a.Diagram,{children:e});return r.mutable=n,r.move_origin(t[0].origin)}function g(t){let e=new u(t);return new c(a.Curve,{path:e})}function p(t,e){return g([t,e]).append_tags(s.LINE)}function f(t){!function(t,e){if(!t)throw new Error(e)}(t.length>=3,"Polygon must have at least 3 points");let e=new u(t);return new c(a.Polygon,{path:e})}function _(t=e(0,0)){return g([t]).append_tags(s.EMPTY)}function m(e){return new c(a.Text,{textdata:{text:e,"font-size":h},path:new u([new t(0,0)])})}function b(t,n,r){let i={src:t},s=new u([e(-n/2,-r/2),e(n/2,-r/2),e(n/2,r/2),e(-n/2,r/2)]);return new c(a.Image,{imgdata:i,path:s})}function v(e){var n;let r=[];for(let t=0;t<e.length;t++){let i=e[t][0],s=null!==(n=e[t][1])&&void 0!==n?n:{};r.push({text:i,style:s})}return new c(a.MultilineText,{multilinedata:{content:r,"scale-factor":1},path:new u([new t(0,0)])})}function y(e,n,r=!1){let i=o.from_BBCode(e,n);return r&&(i=o.split_tspans_by_words(i)),new c(a.MultilineText,{multilinedata:{content:i,"scale-factor":1},path:new u([new t(0,0)])})}function x(t){return t*Math.PI/180}function w(t){return 180*t/Math.PI}function k(t,e){let n=[];for(let r=0;r<e;r++)n.push(t[r%t.length]);return n}function A(t,e,n=100){let r=[],i=(e-t)/(n-1);for(let e=0;e<n;e++)r.push(t+i*e);return r}function E(t,e,n=100){let r=[],i=(e-t)/n;for(let e=0;e<n;e++)r.push(t+i*e);return r}function O(t,e,n=1){if(0==n)return[];if(Math.floor((e-t)/n)<=0)return[];let r=[];if(n>0)for(let i=t;i<e;i+=n)r.push(i);else for(let i=t;i>e;i+=n)r.push(i);return r}function S(t,e,n=1){if(0==n)return[];if(Math.floor((e-t)/n)<=0)return[];let r=[];if(n>0)for(let i=t;i<=e;i+=n)r.push(i);else for(let i=t;i>=e;i+=n)r.push(i);return r}function L(t){let e=[],n=Math.max(...t.map((t=>t.length)));for(let r=0;r<n;r++){e.push([]);for(let n=0;n<t.length;n++)e[r].push(t[n][r])}return e}function C(t){let e=t;return"number"==typeof e?[e,e,e,e]:Array.isArray(e)?1===e.length?[e[0],e[0],e[0],e[0]]:2===e.length?[e[0],e[1],e[0],e[1]]:3===e.length?[e[0],e[1],e[2],e[1]]:e.length>=4?[e[0],e[1],e[2],e[3]]:[0,0,0,0]:[0,0,0,0]}var M=Object.freeze({__proto__:null,array_repeat:k,expand_directional_value:C,linspace:A,linspace_exc:E,range:O,range_inc:S,to_degree:w,to_radian:x,transpose:L});const T={blue:"#1f77b4",lightblue:"#aec7e8",orange:"#ff7f0e",lightorange:"#ffbb78",green:"#2ca02c",lightgreen:"#98df8a",red:"#d62728",lightred:"#ff9896",purple:"#9467bd",lightpurple:"#c5b0d5",brown:"#8c564b",lightbrown:"#c49c94",pink:"#e377c2",lightpink:"#f7b6d2",grey:"#7f7f7f",lightgrey:"#c7c7c7",gray:"#7f7f7f",lightgray:"#c7c7c7",olive:"#bcbd22",lightolive:"#dbdb8d",cyan:"#17becf",lightcyan:"#9edae5"};function N(t,e){var n;return null!==(n=e[t])&&void 0!==n?n:t}const D={A:"ğ´",B:"ğµ",C:"ğ¶",D:"ğ·",E:"ğ¸",F:"ğ¹",G:"ğº",H:"ğ»",I:"ğ¼",J:"ğ½",K:"ğ¾",L:"ğ¿",M:"ğ‘€",N:"ğ‘",O:"ğ‘‚",P:"ğ‘ƒ",Q:"ğ‘„",R:"ğ‘…",S:"ğ‘†",T:"ğ‘‡",U:"ğ‘ˆ",V:"ğ‘‰",W:"ğ‘Š",X:"ğ‘‹",Y:"ğ‘Œ",Z:"ğ‘",a:"ğ‘",b:"ğ‘",c:"ğ‘",d:"ğ‘‘",e:"ğ‘’",f:"ğ‘“",g:"ğ‘”",h:"â„",i:"ğ‘–",j:"ğ‘—",k:"ğ‘˜",l:"ğ‘™",m:"ğ‘š",n:"ğ‘›",o:"ğ‘œ",p:"ğ‘",q:"ğ‘",r:"ğ‘Ÿ",s:"ğ‘ ",t:"ğ‘¡",u:"ğ‘¢",v:"ğ‘£",w:"ğ‘¤",x:"ğ‘¥",y:"ğ‘¦",z:"ğ‘§","Î‘":"ğ›¢","Î’":"ğ›£","Î“":"ğ›¤","Î”":"ğ›¥","Î•":"ğ›¦","Î–":"ğ›§","Î—":"ğ›¨","Î˜":"ğ›©","Î™":"ğ›ª","Îš":"ğ›«","Î›":"ğ›¬","Îœ":"ğ›­","Î":"ğ›®","Î":"ğ›¯","ÎŸ":"ğ›°","Î ":"ğ›±","Î¡":"ğ›²","Î£":"ğ›´","Î¤":"ğ›µ","Î¥":"ğ›¶","Î¦":"ğ›·","Î§":"ğ›¸","Î¨":"ğ›¹","Î©":"ğ›º","Î±":"ğ›¼","Î²":"ğ›½","Î³":"ğ›¾","Î´":"ğ›¿","Îµ":"ğœ€","Î¶":"ğœ","Î·":"ğœ‚","Î¸":"ğœƒ","Î¹":"ğœ„","Îº":"ğœ…","Î»":"ğœ†","Î¼":"ğœ‡","Î½":"ğœˆ","Î¾":"ğœ‰","Î¿":"ğœŠ","Ï€":"ğœ‹","Ï":"ğœŒ","Ï‚":"ğœ","Ïƒ":"ğœ","Ï„":"ğœ","Ï…":"ğœ","Ï†":"ğœ‘","Ï‡":"ğœ’","Ïˆ":"ğœ“","Ï‰":"ğœ”","Ï‘":"ğœ—","Ï°":"ğœ˜","Ï•":"ğœ™","Ï±":"ğœš","Ï–":"ğœ›"};Object.fromEntries(Object.entries(D).map((([t,e])=>[e,t])));const H={"\\alpha":"Î±","\\beta":"Î²","\\gamma":"Î³","\\delta":"Î´","\\epsilon":"Îµ","\\zeta":"Î¶","\\eta":"Î·","\\theta":"Î¸","\\iota":"Î¹","\\kappa":"Îº","\\lambda":"Î»","\\mu":"Î¼","\\nu":"Î½","\\xi":"Î¾","\\omicron":"Î¿","\\pi":"Ï€","\\rho":"Ï","\\sigma":"Ïƒ","\\tau":"Ï„","\\upsilon":"Ï…","\\phi":"Ï•","\\chi":"Ï‡","\\psi":"Ïˆ","\\omega":"Ï‰","\\vartheta":"Ï‘","\\varchi":"Ï°","\\varphi":"Ï†","\\varepsilon":"Îµ","\\varrho":"Ï±","\\varsigma":"Ï‚"},I={textfractionsolidus:"â„",leftrightsquigarrow:"â†­",textpertenthousand:"â€±",blacktriangleright:"â–¸",blacktriangledown:"â–¾",blacktriangleleft:"â—‚",twoheadrightarrow:"â† ",leftrightharpoons:"â‡‹",rightleftharpoons:"â‡Œ",textreferencemark:"â€»",circlearrowright:"â†»",rightrightarrows:"â‡‰",vartriangleright:"âŠ³",textordmasculine:"Âº",textvisiblespace:"â£",twoheadleftarrow:"â†",downharpoonright:"â‡‚",ntrianglerighteq:"â‹­",rightharpoondown:"â‡",textperthousand:"â€°",leftrightarrows:"â‡†",textmusicalnote:"â™ª",nleftrightarrow:"â†®",rightleftarrows:"â‡„",bigtriangledown:"â–½",textordfeminine:"Âª",ntrianglelefteq:"â‹¬",rightthreetimes:"â‹Œ",trianglerighteq:"âŠµ",vartriangleleft:"âŠ²",rightsquigarrow:"â‡",downharpoonleft:"â‡ƒ",curvearrowright:"â†·",circlearrowleft:"â†º",leftharpoondown:"â†½",nLeftrightarrow:"â‡",curvearrowleft:"â†¶",guilsinglright:"â€º",leftthreetimes:"â‹‹",leftrightarrow:"â†”",rightharpoonup:"â‡€",guillemotright:"Â»",downdownarrows:"â‡Š",hookrightarrow:"â†ª",dashrightarrow:"â‡¢",leftleftarrows:"â‡‡",trianglelefteq:"âŠ´",ntriangleright:"â‹«",doublebarwedge:"âŒ†",upharpoonright:"â†¾",rightarrowtail:"â†£",looparrowright:"â†¬",Leftrightarrow:"â‡”",sphericalangle:"âˆ¢",divideontimes:"â‹‡",measuredangle:"âˆ¡",blacktriangle:"â–´",ntriangleleft:"â‹ª",mathchar1356:"â",texttrademark:"â„¢",mathchar2208:"âŒ–",triangleright:"â–¹",leftarrowtail:"â†¢",guilsinglleft:"â€¹",upharpoonleft:"â†¿","mathbb{gamma}":"â„½",fallingdotseq:"â‰’",looparrowleft:"â†«",textbrokenbar:"Â¦",hookleftarrow:"â†©",smallsetminus:"ï¹¨",dashleftarrow:"â‡ ",guillemotleft:"Â«",leftharpoonup:"â†¼","mathbb{Gamma}":"â„¾",bigtriangleup:"â–³",textcircledP:"â„—",risingdotseq:"â‰“",triangleleft:"â—ƒ",mathsterling:"Â£",textcurrency:"Â¤",triangledown:"â–¿",blacklozenge:"î ‹","sfrac{5}{6}":"â…š",preccurlyeq:"â‰¼",Rrightarrow:"â‡›",circledcirc:"âŠš",nRightarrow:"â‡","sfrac{3}{8}":"â…œ","sfrac{1}{3}":"â…“","sfrac{2}{5}":"â…–",vartriangle:"â–µ",Updownarrow:"â‡•",nrightarrow:"â†›","sfrac{1}{2}":"Â½","sfrac{3}{5}":"â…—",succcurlyeq:"â‰½","sfrac{4}{5}":"â…˜",diamondsuit:"â™¦","sfrac{1}{6}":"â…™",curlyeqsucc:"â‹Ÿ",blacksquare:"â–ª",curlyeqprec:"â‹","sfrac{1}{8}":"â…›","sfrac{7}{8}":"â…","sfrac{1}{5}":"â…•","sfrac{2}{3}":"â…”",updownarrow:"â†•",backepsilon:"âˆ",circleddash:"âŠ",eqslantless:"â‹œ","sfrac{3}{4}":"Â¾","sfrac{5}{8}":"â…","sfrac{1}{4}":"Â¼","mathbb{Pi}":"â„¿","mathcal{M}":"â„³","mathcal{o}\t":"â„´","mathcal{O}\t":"ğ’ª",nsupseteqq:"âŠ‰","mathcal{B}":"â„¬",textrecipe:"â„",nsubseteqq:"âŠˆ",subsetneqq:"âŠŠ","mathcal{I}":"â„‘",upuparrows:"â‡ˆ","mathcal{e}":"â„¯","mathcal{L}":"â„’",nleftarrow:"â†š","mathcal{H}":"â„‹","mathcal{E}":"â„°",eqslantgtr:"â‹",curlywedge:"â‹",varepsilon:"Îµ",supsetneqq:"âŠ‹",rightarrow:"â†’","mathcal{R}":"â„›",sqsubseteq:"âŠ‘","mathcal{g}":"â„Š",sqsupseteq:"âŠ’",complement:"âˆ",Rightarrow:"â‡’",gtreqqless:"â‹›",lesseqqgtr:"â‹š",circledast:"âŠ›",nLeftarrow:"â‡",Lleftarrow:"â‡š",varnothing:"âˆ…","mathcal{N}":"ğ’©",Leftarrow:"â‡",gvertneqq:"â‰©","mathbb{C}":"â„‚",supsetneq:"âŠ‹",leftarrow:"â†",nleqslant:"â‰°","mathbb{Q}":"â„š","mathbb{Z}":"â„¤",llbracket:"ã€š","mathbb{H}":"â„",spadesuit:"â™ ","mathit{o}":"â„´","mathbb{P}":"â„™",rrbracket:"ã€›",supseteqq:"âŠ‡",copyright:"Â©","textsc{k}":"Ä¸",gtreqless:"â‹›","mathbb{j}":"â…‰",pitchfork:"â‹”",estimated:"â„®",ngeqslant:"â‰±","mathbb{e}":"â…‡",therefore:"âˆ´",triangleq:"â‰œ",varpropto:"âˆ",subsetneq:"âŠŠ",heartsuit:"â™¥","mathbb{d}":"â…†",lvertneqq:"â‰¨",checkmark:"âœ“",nparallel:"âˆ¦","mathbb{R}":"â„",lesseqgtr:"â‹š",downarrow:"â†“","mathbb{D}":"â……","mathbb{i}":"â…ˆ",backsimeq:"â‹","mathbb{N}":"â„•",Downarrow:"â‡“",subseteqq:"âŠ†",setminus:"âˆ–",succnsim:"â‹©",doteqdot:"â‰‘",clubsuit:"â™£",emptyset:"âˆ…",sqsupset:"âŠ","fbox{~~}":"â–­",curlyvee:"â‹",varkappa:"Ï°",llcorner:"âŒ",varsigma:"Ï‚",approxeq:"â‰Š",backcong:"â‰Œ",supseteq:"âŠ‡",circledS:"â“ˆ",circledR:"Â®",textcent:"Â¢",urcorner:"âŒ",lrcorner:"âŒŸ",boxminus:"âŠŸ",texteuro:"â‚¬",vartheta:"Ï‘",barwedge:"âŠ¼","ding{86}":"âœ¶",sqsubset:"âŠ",subseteq:"âŠ†",intercal:"âŠº","ding{73}":"â˜†",ulcorner:"âŒœ",recorder:"âŒ•",precnsim:"â‹¨",parallel:"âˆ¥",boxtimes:"âŠ ","ding{55}":"âœ—",multimap:"âŠ¸",maltese:"âœ ",nearrow:"â†—",swarrow:"â†™",lozenge:"â—Š","sqrt[3]":"âˆ›",succsim:"â‰¿",dotplus:"âˆ”","tilde{}":"~","check{}":"Ë‡",lessgtr:"â‰¶",Upsilon:"Ï’",Cdprime:"Ğª",gtrless:"â‰·",backsim:"âˆ½",nexists:"âˆ„",searrow:"â†˜",lessdot:"â‹–",boxplus:"âŠ",upsilon:"Ï…",epsilon:"Îµ",diamond:"â‹„",bigstar:"â˜…",ddagger:"â€¡",cdprime:"ÑŠ",Uparrow:"â‡‘","sqrt[4]":"âˆœ",between:"â‰¬",sqangle:"âˆŸ",digamma:"Ïœ",uparrow:"â†‘",nwarrow:"â†–",precsim:"â‰¾","breve{}":"Ë˜",because:"âˆµ",bigcirc:"â—¯","acute{}":"Â´","grave{}":"`",lesssim:"â‰²",partial:"âˆ‚",natural:"â™®",supset:"âŠƒ",hstrok:"Ä§",Tstrok:"Å¦",coprod:"âˆ",models:"âŠ§",otimes:"âŠ—",degree:"Â°",gtrdot:"â‹—",preceq:"â‰¼",Lambda:"Î›",lambda:"Î»",cprime:"ÑŒ",varrho:"Ï±",Bumpeq:"â‰",hybull:"âƒ",lmidot:"Å€",nvdash:"âŠ¬",lbrace:"{",bullet:"â€¢",varphi:"Ï†",bumpeq:"â‰","ddot{}":"Â¨",Lmidot:"Ä¿",Cprime:"Ğ¬",female:"â™€",rtimes:"â‹Š",gtrsim:"â‰³",mapsto:"â†¦",daleth:"â„¸",square:"â– ",nVDash:"âŠ¯",rangle:"âŸ©",tstrok:"Å§",oslash:"âŠ˜",ltimes:"â‹‰",lfloor:"âŒŠ",marker:"â–®",Subset:"â‹",Vvdash:"âŠª",propto:"âˆ",Hstrok:"Ä¦",dlcrop:"âŒ",forall:"âˆ€",nVdash:"âŠ®",Supset:"â‹‘",langle:"âŸ¨",ominus:"âŠ–",rfloor:"âŒ‹",circeq:"â‰—",eqcirc:"â‰–",drcrop:"âŒŒ",veebar:"âŠ»",ulcrop:"âŒ",nvDash:"âŠ­",urcrop:"âŒ",exists:"âˆƒ",approx:"â‰ˆ",dagger:"â€ ",boxdot:"âŠ¡",succeq:"â‰½",bowtie:"â‹ˆ",subset:"âŠ‚",notin:"âˆ‰",Sigma:"Î£",Omega:"Î©",nabla:"âˆ‡",colon:":",boxHu:"â•§",boxHd:"â•¤",aleph:"â„µ",gnsim:"â‹§",boxHU:"â•©",boxHD:"â•¦",equiv:"â‰¡",lneqq:"â‰¨",alpha:"Î±",amalg:"âˆ",boxhU:"â•¨",boxhD:"â•¥",uplus:"âŠ",boxhu:"â”´",kappa:"Îº",sigma:"Ïƒ",boxDL:"â•—",Theta:"Î˜",Vdash:"âŠ©",boxDR:"â•”",boxDl:"â•–",sqcap:"âŠ“",boxDr:"â•“","bar{}":"Â¯",dashv:"âŠ£",vDash:"âŠ¨",boxdl:"â”",boxVl:"â•¢",boxVh:"â•«",boxVr:"â•Ÿ",boxdr:"â”Œ",boxdL:"â••",boxVL:"â•£",boxVH:"â•¬",boxVR:"â• ",boxdR:"â•’",theta:"Î¸",lhblk:"â–„",uhblk:"â–€",ldotp:".",ldots:"â€¦",boxvL:"â•¡",boxvH:"â•ª",boxvR:"â•",boxvl:"â”¤",boxvh:"â”¼",boxvr:"â”œ",Delta:"Î”",boxUR:"â•š",boxUL:"â•",oplus:"âŠ•",boxUr:"â•™",boxUl:"â•œ",doteq:"â‰",happy:"ã‹¡",varpi:"Ï–",smile:"â˜º",boxul:"â”˜",simeq:"â‰ƒ",boxuR:"â•˜",boxuL:"â•›",boxhd:"â”¬",gimel:"â„·",Gamma:"Î“",lnsim:"â‹¦",sqcup:"âŠ”",omega:"Ï‰",sharp:"â™¯",times:"Ã—",block:"â–ˆ","hat{}":"^",wedge:"âˆ§",vdash:"âŠ¢",angle:"âˆ ",infty:"âˆ",gamma:"Î³",asymp:"â‰",rceil:"âŒ‰","dot{}":"Ë™",lceil:"âŒˆ",delta:"Î´",gneqq:"â‰©",frown:"âŒ¢",phone:"â˜",vdots:"â‹®",boxr:"â””","k{i}":"Ä¯","`{I}":"ÃŒ",perp:"âŠ¥",'"{o}':"Ã¶","={I}":"Äª","`{a}":"Ã ","v{T}":"Å¤",surd:"âˆš","H{O}":"Å",vert:"|","k{I}":"Ä®",'"{y}':"Ã¿",'"{O}':"Ã–","u{u}":"Ñ","u{G}":"Ä",".{E}":"Ä–",".{z}":"Å¼","v{t}":"Å¥",prec:"â‰º","H{o}":"Å‘",mldr:"â€¦",cong:"â‰…",".{e}":"Ä—",star:"*",".{Z}":"Å»",geqq:"â‰§",cdot:"â‹…",cdots:"â€¦","`{U}":"Ã™","v{L}":"Ä½","c{s}":"ÅŸ","~{A}":"Ãƒ",Vert:"â€–","k{e}":"Ä™",lnot:"Â¬",leqq:"â‰¦",beta:"Î²",beth:"â„¶","~{n}":"Ã±","u{i}":"Ğ¹","c{S}":"Å","c{N}":"Å…","H{u}":"Å±","v{n}":"Åˆ","={U}":"Åª","~{O}":"Ã•","v{E}":"Äš","H{U}":"Å°","v{N}":"Å‡",prod:"âˆ","v{s}":"Å¡",'"{U}':"Ãœ","c{n}":"Å†","k{U}":"Å²","c{R}":"Å–","~{o}":"Ãµ","v{e}":"Ä›","v{S}":"Å ","u{A}":"Ä‚",circ:"âˆ˜",'"{u}':"Ã¼",flat:"â™­","v{z}":"Å¾","r{U}":"Å®","`{O}":"Ã’","={u}":"Å«",oint:"âˆ®","c{K}":"Ä¶","k{u}":"Å³","not<":"â‰®","not>":"â‰¯","`{o}":"Ã²",'"{I}':"Ã","v{D}":"Ä",".{G}":"Ä ","r{u}":"Å¯","not=":"â‰ ","`{u}":"Ã¹","v{c}":"Ä","c{k}":"Ä·",".{g}":"Ä¡",odot:"âŠ™","`{e}":"Ñ","c{T}":"Å¢","v{d}":"Ä",'"{e}':"Ñ‘","v{R}":"Å˜","k{a}":"Ä…",nldr:"â€¥","`{A}":"Ã€","~{N}":"Ã‘",nmid:"âˆ¤",".{C}":"ÄŠ",zeta:"Î¶","~{u}":"Å©","`{E}":"Ğ­","~{a}":"Ã£","c{t}":"Å£","={o}":"Å","v{r}":"Å™","={A}":"Ä€",".{c}":"Ä‹","~{U}":"Å¨","k{A}":"Ä„",'"{a}':"Ã¤","u{U}":"Ğ",iota:"Î¹","={O}":"ÅŒ","c{C}":"Ã‡",gneq:"â‰©",boxH:"â•",hbar:"â„",'"{A}':"Ã„",boxv:"â”‚",boxh:"â”€",male:"â™‚",sqrt:"âˆš",succ:"â‰»","c{c}":"Ã§","v{l}":"Ä¾","u{a}":"Äƒ","v{Z}":"Å½","c{G}":"Ä¢","v{C}":"ÄŒ",lneq:"â‰¨","{E}":"Ğ","={a}":"Ä","c{l}":"Ä¼","={E}":"Ä’",boxV:"â•‘","u{g}":"ÄŸ","u{I}":"Ğ™","c{L}":"Ä»","k{E}":"Ä˜",".{I}":"Ä°","~{I}":"Ä¨","c{r}":"Å—","{Y}":"Å¸","={e}":"Ä“",leq:"â‰¤",Cup:"â‹“",Psi:"Î¨",neq:"â‰ ","k{}":"Ë›","={}":"â€¾","H{}":"Ë",cup:"âˆª",geq:"â‰¥",mho:"â„§",Dzh:"Ğ",cap:"âˆ©",bot:"âŠ¥",psi:"Ïˆ",chi:"Ï‡","c{}":"Â¸",Phi:"Î¦",ast:"*",ell:"â„“",top:"âŠ¤",lll:"â‹˜",tau:"Ï„",Cap:"â‹’",sad:"â˜¹",iff:"â‡”",eta:"Î·",eth:"Ã°","d{":"\tÌ£",rho:"Ï",dzh:"ÑŸ",div:"Ã·",phi:"Ï•",Rsh:"â†±",vee:"âˆ¨","b{}":"Ë","t{":"\tÍ¡",int:"âˆ«",sim:"âˆ¼","r{}":"Ëš",Lsh:"â†°",yen:"Â¥",ggg:"â‹™",mid:"âˆ£",sum:"âˆ‘",neg:"Â¬",Dz:"Ğ…",Re:"â„œ",oe:"Å“",DH:"Ã",ll:"â‰ª",ng:"Å‹",wr:"â‰€",wp:"â„˜","=I":"Ğ†",":)":"â˜º",":(":"â˜¹",AE:"Ã†",AA:"Ã…",ss:"ÃŸ",dz:"Ñ•",ae:"Ã¦",aa:"Ã¥",th:"Ã¾",to:"â†’",Pi:"Î ",mp:"âˆ“",Im:"â„‘",pm:"Â±",pi:"Ï€",'"I':"Ğ‡",in:"âˆˆ",ni:"âˆ‹",ne:"â‰ ",TH:"Ã",Xi:"Î",nu:"Î½",NG:"ÅŠ",":G":"ã‹¡",xi:"Î¾",OE:"Å’",gg:"â‰«",DJ:"Ä","=e":"Ñ”","=E":"Ğ„",mu:"Î¼",dj:"Ä‘",S:"Â§",P:"Â¶",O:"Ã˜",L:"Å",o:"Ã¸",l:"Å‚",h:"â„",i:"â„¹","'{Y}":"Ã","'{y}":"Ã½","'{L}":"Ä¹","'{e}":"Ã©","'{l}":"Äº","'{s}":"Å›","'{z}":"Åº","'{E}":"Ã‰","'{S}":"Åš","'{Z}":"Å¹","'{R}":"Å”","'{A}":"Ã","'{N}":"Åƒ","'{I}":"Ã","'{n}":"Å„","'{c}":"Ä‡","'{u}":"Ãº","'{C}":"Ä†","'{o}":"Ã³","'{a}":"Ã¡","'{O}":"Ã“","'{g}":"Çµ","'{r}":"Å•","'{U}":"Ãš","'G":"Ğƒ","'C":"Ğ‹","'K":"ĞŒ","'k":"Ñœ","'c":"Ñ›","'g":"Ñ“"};function R(t){for(let e in H)t=t.replaceAll(e,H[e]);for(let e in I)t=t.replaceAll("\\"+e,I[e]);return t}function z(t){return[...R(t)].map((t=>D[t]||t)).join("")}const j={fill:"none",stroke:"black","stroke-width":"1","stroke-linecap":"butt","stroke-dasharray":"none","stroke-linejoin":"round","vector-effect":"non-scaling-stroke",opacity:"1"},q=Object.assign({},j),B={fill:"black",stroke:"none","stroke-width":"1","stroke-linecap":"butt","stroke-dasharray":"none","stroke-linejoin":"round","vector-effect":"non-scaling-stroke",opacity:"1"},P=Object.assign({},B),G={text:"","font-family":"Latin Modern Math, sans-serif","font-size":h,"font-weight":"normal","text-anchor":"middle",dy:"0.25em",angle:"0","font-style":"normal","font-scale":"auto"},F=Object.assign({},G);function V(){for(let t in j)j[t]=q[t];for(let t in B)B[t]=P[t];for(let t in G)G[t]=F[t]}const $=new Map;function U(t,e,n,r){let i=document.createElementNS("http://www.w3.org/2000/svg","image");if(i.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),null==e.imgdata.src)return;if(null==e.path)return;if(4!=e.path.points.length)return;let s=e.path.points[1].sub(e.path.points[0]).length(),a=e.path.points[2].sub(e.path.points[1]).length(),l=e.path.points[1].sub(e.path.points[0]).normalize(),o=e.path.points[3].sub(e.path.points[0]).normalize(),h=l.x,c=-l.y,u=-o.x,d=o.y,g=e.path.points[3].x,p=-e.path.points[3].y;n?function(t,e){if(/^data:image\/(png|jpeg|jpg|gif|svg\+xml);base64,/.test(e))return t.setAttribute("href",e),void t.setAttribute("xlink:href",e);if($.has(e)){const n=$.get(e);if(!n)return;return t.setAttribute("href",n),void t.setAttribute("xlink:href",n)}let n=document.createElement("canvas"),r=n.getContext("2d"),i=new Image;i.crossOrigin="anonymous",i.onload=()=>{n.height=i.height,n.width=i.width,null==r||r.drawImage(i,0,0);const s=n.toDataURL("image/png");t.setAttribute("href",s),t.setAttribute("xlink:href",s),$.set(e,s),n.remove()},i.src=e}(i,e.imgdata.src):i.setAttribute("href",e.imgdata.src),i.setAttribute("width",s.toString()),i.setAttribute("height",a.toString()),i.setAttribute("transform",`matrix(${h} ${c} ${u} ${d} ${g} ${p})`),i.setAttribute("preserveAspectRatio","none"),null!=r&&i.setAttribute("_dg_tag",r),t.appendChild(i)}function X(t,e){if(t.type==e)return[t];if(t.type==a.Diagram){let n=[];for(let r of t.children)n=n.concat(X(r,e));return n}return[]}function W(t,e){const n=C(null!=e?e:0);let r=t.getBBox(),i=t.width.baseVal.value-n[1]-n[3],s=t.height.baseVal.value-n[0]-n[2];return Math.max(r.width/i,r.height/s)}function Y(t,e){var n;let r=[];for(let i in e.children){let s=e.children[i];s instanceof SVGElement&&(s.getAttribute("_dg_tag")==t&&r.push(s),(null===(n=s.children)||void 0===n?void 0:n.length)&&(r=r.concat(Y(t,s))))}return r}function K(t,e,n,r=!0,i=!1,l,o){if(n.type==a.Polygon)!function(t,e,n,r){let i=Object.assign(Object.assign({},j),n.style);i.fill=N(i.fill,T),i.stroke=N(i.stroke,T);let s=document.createElementNS("http://www.w3.org/2000/svg","polygon");for(let t in i)s.style[t]=i[t];if(null!=r&&s.setAttribute("_dg_tag",r),e.appendChild(s),null!=n.path)for(let e=0;e<n.path.points.length;e++){let r=n.path.points[e];var a=t.createSVGPoint();a.x=r.x,a.y=-r.y,s.points.appendItem(a)}}(t,e,n,o);else if(n.type==a.Curve)!function(t,e,n,r){let i=Object.assign(Object.assign({},j),n.style);i.fill="none",i.stroke=N(i.stroke,T);let s=document.createElementNS("http://www.w3.org/2000/svg","polyline");for(let t in i)s.style[t]=i[t];if(null!=r&&s.setAttribute("_dg_tag",r),e.appendChild(s),null!=n.path)for(let e=0;e<n.path.points.length;e++){let r=n.path.points[e];var a=t.createSVGPoint();a.x=r.x,a.y=-r.y,s.points.appendItem(a)}}(t,e,n,o);else if(n.type==a.Text||n.type==a.MultilineText);else if(n.type==a.Image)U(e,n,i,o);else if(n.type==a.Diagram)for(let r of n.children)K(t,e,r,!1,i,void 0,o);else console.warn("Unreachable, unknown diagram type : "+n.type);if(r){null==l&&(l=W(t));let r=X(n,a.Text),i=X(n,a.MultilineText);!function(t,e,n,r){for(let i of e){let e=Object.assign(Object.assign({},B),i.style);e.fill=N(e.fill,T),e.stroke=N(e.stroke,T);let a=Object.assign(Object.assign({},G),i.textdata);if(null==i.path)throw new Error("Text must have a path");let l=document.createElementNS("http://www.w3.org/2000/svg","text"),o=i.path.points[0].x,h=-i.path.points[0].y,c=w(parseFloat(a.angle)),u="auto"==a["font-scale"]?n:parseFloat(a["font-scale"]),d=parseFloat(a["font-size"])*u;l.setAttribute("font-family",a["font-family"]),l.setAttribute("font-style",a["font-style"]),l.setAttribute("font-size",d.toString()),l.setAttribute("font-weight",a["font-weight"]),l.setAttribute("text-anchor",a["text-anchor"]),l.setAttribute("dy",a.dy),l.setAttribute("transform",`translate(${o} ${h}) rotate(${c}) `),null!=r&&l.setAttribute("_dg_tag",r),l.setAttribute("_x",o.toString()),l.setAttribute("_y",h.toString()),l.setAttribute("_angle",c.toString());for(let t in e)l.style[t]=e[t];let g=a.text;i.tags.includes(s.TEXTVAR)&&!Q(g)&&(g=z(g)),l.innerHTML=g,t.appendChild(l)}}(e,r,null!=l?l:1,o),function(t,e,n,r){var i,s,a,l,o;for(let h of e){if(null==h.path)throw new Error("Text must have a path");let e=document.createElementNS("http://www.w3.org/2000/svg","text"),c=h.path.points[0].x,u=-h.path.points[0].y,d=0,g=Object.assign(Object.assign(Object.assign({},G),{dy:"0","text-anchor":"start"}),h.textdata),p=g["font-size"];if(null==(null===(i=h.multilinedata)||void 0===i?void 0:i.content))throw new Error("MultilineText must have multilinedata");let f=null!==(s=h.multilinedata["scale-factor"])&&void 0!==s?s:1,_=!0,m=!0,b="1em";for(let t of h.multilinedata.content){if("\n"==t.text){m=!0,b=null!==(a=t.style.dy)&&void 0!==a?a:"1em";continue}let r=document.createElementNS("http://www.w3.org/2000/svg","tspan"),i=null==t.style.dy,s=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},B),g),{dy:"0",dx:"0"}),{"font-size":p}),t.style);if(m){r.setAttribute("x","0");let t=null!==(l=g.dy)&&void 0!==l?l:"0";i&&(s.dy=_?t:b),m=!1}let h="auto"==s["font-scale"]?n:parseFloat(s["font-scale"]),c=null!==(o=s["font-size-scale-factor"])&&void 0!==o?o:1,u=parseFloat(s["font-size"])*h*f*c;s.tag&&r.setAttribute("_dg_tag",s.tag),r.style.whiteSpace="pre",r.setAttribute("dx",s.dx),r.setAttribute("dy",s.dy),r.setAttribute("font-style",s["font-style"]),r.setAttribute("font-family",s["font-family"]),r.setAttribute("font-size",u.toString()),r.setAttribute("font-weight",s["font-weight"]),r.style.fill=N(s.fill,T),r.style.stroke=N(s.stroke,T),r.style.opacity=s.opacity,s["baseline-shift"]&&r.setAttribute("baseline-shift",s["baseline-shift"]);let d=t.text;s.textvar&&(d=z(d)),r.innerHTML=d,e.appendChild(r),_=!1}e.setAttribute("dy",g.dy),e.setAttribute("text-anchor",g["text-anchor"]),e.setAttribute("transform",`translate(${c} ${u}) rotate(${d}) `),null!=r&&e.setAttribute("_dg_tag",r),t.appendChild(e)}}(e,i,null!=l?l:1,o)}}function J(t,e,n=!0,r=!0,i=!0){Z(t,e,{set_html_attribute:n,render_text:r,clear_svg:i})}function Z(t,e,n={}){var r,i,s,a,l,o,h;const c=null===(r=n.set_html_attribute)||void 0===r||r,u=null===(i=n.render_text)||void 0===i||i,d=null===(s=n.clear_svg)||void 0===s||s,g=null!==(a=n.embed_image)&&void 0!==a&&a;let p,f;for(let e in t.children){let n=t.children[e];if(n instanceof SVGSVGElement&&"diagram_svg"==n.getAttribute("meta")){p=n;break}}if(null==p&&(p=document.createElementNS("http://www.w3.org/2000/svg","svg"),p.setAttribute("meta","diagram_svg"),p.setAttribute("width","100%"),p.setAttribute("height","100%"),t.appendChild(p)),function(t,e){if(null==e||0==e.length)return;let n=t.querySelector("defs");null==n&&(n=document.createElementNS("http://www.w3.org/2000/svg","defs"),t.insertBefore(n,t.firstChild));n.innerHTML="";for(let t of e)n.innerHTML+=t}(t,n.filter_strings),n.text_scaling_reference_svg&&(n.text_scaling_reference_padding=null!==(o=null!==(l=n.text_scaling_reference_padding)&&void 0!==l?l:n.padding)&&void 0!==o?o:10,n.text_scaling_reference_padding=C(n.text_scaling_reference_padding),f=W(n.text_scaling_reference_svg,n.text_scaling_reference_padding)),d&&(p.innerHTML=""),K(p,p,e,u,g,f),c){const e=C(null!==(h=n.padding)&&void 0!==h?h:10);let r=p.getBBox(),i=p.width.baseVal.value-e[1]-e[3],s=p.height.baseVal.value-e[0]-e[2],a=Math.max(r.width/i,r.height/s),l=e.map((t=>t*a));r.x-=l[3],r.y-=l[0],r.width+=l[1]+l[3],r.height+=l[0]+l[2],p.setAttribute("viewBox",`${r.x} ${r.y} ${r.width} ${r.height}`),p.setAttribute("preserveAspectRatio","xMidYMid meet"),t.style.overflow="visible"}if(n.background_color){let t=p.getBBox();0!==p.viewBox.baseVal.width&&(t=p.viewBox.baseVal);let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("x",t.x.toString()),e.setAttribute("y",t.y.toString()),e.setAttribute("width",t.width.toString()),e.setAttribute("height",t.height.toString()),e.style.fill=N(n.background_color,T),e.style.stroke="none",p.insertBefore(e,p.firstChild)}}function Q(t){return t.startsWith("$")&&t.endsWith("$")}function tt(t){return t.startsWith("$$")&&t.endsWith("$$")}function et(t,e){for(let r=0;r<t.children.length;r++){let i=t.children[r];if(i instanceof SVGTextElement){let s=i.innerHTML;if(!Q(s))continue;let a=i.getAttribute("font-size");if(null==a)continue;let l=parseFloat(a),o=e(tt(n=s)?n.substring(2,n.length-2):Q(n)?n.substring(1,n.length-1):n,{display:tt(s)}),h=i.getAttribute("_x"),c=i.getAttribute("_y");if(null==h||null==c)continue;let u=i.getAttribute("text-anchor"),d=i.getAttribute("dy");if(null==u||null==d)continue;i.outerHTML=o,i=t.children[r];let g=i.getAttribute("width");if(null==g)continue;let p=parseFloat(g.substring(0,g.length-2)),f=i.getAttribute("height");if(null==f)continue;const _=2;let m=p*l/_,b=parseFloat(f.substring(0,f.length-2))*l/_,v=parseFloat(h),y=parseFloat(c);switch(u){case"start":break;case"middle":v-=m/2;break;case"end":v-=m}switch(d){case"0.75em":break;case"0.25em":y-=b/2;break;case"-0.25em":y-=b}i.setAttribute("width",m.toString()),i.setAttribute("height",b.toString()),i.setAttribute("x",v.toString()),i.setAttribute("y",y.toString())}else i instanceof SVGElement&&et(i,e)}var n}function nt(t){let e=t.querySelector("svg[meta=diagram_svg]");if(null==e)return void console.warn("Cannot find svg element");let n=t.querySelector("svg[meta=control_svg]"),r=e;if(null!=n){let t=e.cloneNode(!0);for(let e in n.children){let r=n.children[e];r instanceof SVGSVGElement&&t.appendChild(r.cloneNode(!0))}r=t}let i=(new XMLSerializer).serializeToString(r),s=new Blob([i],{type:"image/svg+xml"}),a=URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.download="diagramatics.svg",l.click()}function rt(t){if(null==t.querySelector("svg[meta=diagram_svg]"))return void console.warn("Cannot find svg element");let e=t,n=(new XMLSerializer).serializeToString(e),r=new Blob([n],{type:"image/svg+xml"});const i=window.URL||window.webkitURL||window,s=i.createObjectURL(r),a=new Image;a.width=e.width.baseVal.value,a.height=e.height.baseVal.value,a.src=s,a.onload=function(){const t=document.createElement("canvas");t.width=a.width,t.height=a.height;const e=t.getContext("2d");null==e||e.drawImage(a,0,0),i.revokeObjectURL(s);const n=t.toDataURL("image/png").replace("image/png","image/octet-stream"),r=document.createElement("a");r.href=n,r.download="diagramatics.png",r.click()}}function it(t,n){return f([e(-t/2,-n/2),e(t/2,-n/2),e(t/2,n/2),e(-t/2,n/2)])}function st(t,n){return f([t,e(n.x,t.y),n,e(t.x,n.y)])}function at(t=1){return it(t,t)}function lt(t,n=1){let r=[];for(let i=0;i<t;i++)r.push(e(0,n).rotate(2*i*Math.PI/t));return f(r)}function ot(t,e=1){return lt(t,e/(2*Math.sin(Math.PI/t)))}function ht(t=1){return lt(50,t).append_tags(s.CIRCLE)}function ct(t=1,n=x(360)){let r=[];for(let i=0;i<100;i++)r.push(e(t,0).rotate(i*n/99));return g(r)}function ut(t,n=1){return d(p(e(0,0),t).append_tags(s.ARROW_LINE),f([e(0,0),e(-n,n/2),e(-n,-n/2)]).rotate(t.angle()).position(t).append_tags(s.ARROW_HEAD))}function dt(t,e,n=1){return ut(e.sub(t),n).position(t)}function gt(t,n,r=1){let i=p(t,n).append_tags(s.ARROW_LINE),a=n.sub(t),l=f([e(0,0),e(-r,r/2),e(-r,-r/2)]);return d(i,l.rotate(a.angle()).position(n).append_tags(s.ARROW_HEAD),l.rotate(a.angle()+Math.PI).position(t).append_tags(s.ARROW_HEAD))}function pt(t){return m(t).append_tags(s.TEXTVAR)}function ft(t){if(!t.tags.includes(s.CIRCLE))return-1;let e=t.get_anchor("center-center");if(null==t.path)return-1;let n=t.path.points[0];return e.sub(n).length()}function _t(t){return t.tags.includes(s.LINE)?null==t.path?[e(0,0),e(0,0)]:[t.path.points[0],t.path.points[1]]:[e(0,0),e(0,0)]}function mt(t){let e=t.bounding_box();return[e[1].x-e[0].x,e[1].y-e[0].y]}var bt=Object.freeze({__proto__:null,area:function t(e){var n,r;return e.type==a.Polygon?function(t){let e=0;const n=t.length;for(let r=0;r<n;r++){const i=(r+1)%n,s=t[r].x,a=t[r].y,l=t[i].x;e+=s*t[i].y-l*a}return Math.abs(e)/2}(null!==(r=null===(n=e.path)||void 0===n?void 0:n.points)&&void 0!==r?r:[]):e.type==a.Diagram?e.children.reduce(((e,n)=>e+t(n)),0):0},circle_radius:ft,circle_tangent_point_from_point:function(t,n){let r=ft(n);if(-1==r)return[e(0,0),e(0,0)];let i=n.get_anchor("center-center"),s=r,a=i.sub(t).length_sq(),l=s*s,o=t.sub(i),h=l/a,c=o.scale(h),u=s*Math.sqrt(a-l)/a,d=e(-o.y,o.x).scale(u);return[c.add(d).add(i),c.sub(d).add(i)]},line_extend:function(t,e,n){if(!t.tags.includes(s.LINE))return t;if(null==t.path)return t;let r=t.path.points[0],i=t.path.points[1],a=i.sub(r).normalize(),l=r.sub(a.scale(e)),o=i.add(a.scale(n)),h=t.copy();return null==h.path?t:(h.path.points=[l,o],h)},line_intersection:function(t,n){if(!t.tags.includes(s.LINE)||!n.tags.includes(s.LINE))return e(1/0,1/0);let[r,i]=_t(t),[a,l]=_t(n),o=r.x,h=r.y,c=i.x,u=i.y,d=a.x,g=a.y,p=l.x,f=l.y,_=(o-c)*(g-f)-(h-u)*(d-p);return 0==_?e(1/0,1/0):e(((o*u-h*c)*(d-p)-(o-c)*(d*f-g*p))/_,((o*u-h*c)*(g-f)-(h-u)*(d*f-g*p))/_)},line_intersection_x:function(t,n){let[r,i]=_t(t);return e(n,r.y+(i.y-r.y)*(n-r.x)/(i.x-r.x))},line_intersection_y:function(t,n){let[r,i]=_t(t);return e(r.x+(i.x-r.x)*(n-r.y)/(i.y-r.y),n)},line_points:_t,size:mt});function vt(t,n="center"){if(0==t.length)return _();let r=[...t];if("top"==n){let t=r[0].get_anchor("top-left").y;for(let n=0;n<r.length;n++)r[n]=r[n].translate(e(0,t-r[n].get_anchor("top-left").y));return d(...r)}if("center"==n){let t=r[0].get_anchor("center-left").y;for(let n=0;n<r.length;n++)r[n]=r[n].translate(e(0,t-r[n].get_anchor("center-left").y));return d(...r)}if("bottom"==n){let t=r[0].get_anchor("bottom-left").y;for(let n=0;n<r.length;n++)r[n]=r[n].translate(e(0,t-r[n].get_anchor("bottom-left").y));return d(...r)}throw new Error("Unknown vertical alignment : "+n)}function yt(t,n="center"){if(0==t.length)return _();let r=[...t];if("left"==n){let t=r[0].get_anchor("top-left").x;for(let n=0;n<r.length;n++)r[n]=r[n].translate(e(t-r[n].get_anchor("top-left").x,0));return d(...r)}if("center"==n){let t=r[0].get_anchor("top-center").x;for(let n=0;n<r.length;n++)r[n]=r[n].translate(e(t-r[n].get_anchor("top-center").x,0));return d(...r)}if("right"==n){let t=r[0].get_anchor("top-right").x;for(let n=0;n<r.length;n++)r[n]=r[n].translate(e(t-r[n].get_anchor("top-right").x,0));return d(...r)}throw new Error("Unknown horizontal alignment : "+n)}function xt(t,n=0){if(0==t.length)return _();let r=[...t],i=[r[0]];for(let t=1;t<r.length;t++){let s=i[t-1],a=r[t],l=s.get_anchor("top-right").x-a.get_anchor("top-left").x+n;i.push(a.translate(e(l,0)))}return d(...i)}function wt(t,n=0){if(0==t.length)return _();let r=[...t],i=[r[0]];for(let t=1;t<r.length;t++){let s=i[t-1],a=r[t],l=s.get_anchor("bottom-left").y-a.get_anchor("top-left").y-n;i.push(a.translate(e(0,l)))}return d(...i)}function kt(t,e=0,n="center"){return xt(vt(t,n).children,e)}function At(t,e=0,n="center"){return wt(yt(t,n).children,e)}function Et(t,e,n=0,r=0){if(0==t.length)return _();let i=[...t],s=Math.ceil(i.length/e),a=[];for(let t=0;t<s;t++)a.push(i.slice(t*e,(t+1)*e));let l=wt(a.map((t=>xt(t,r))),n),o=[];for(let t=0;t<l.children.length;t++)for(let e=0;e<l.children[t].children.length;e++)o.push(l.children[t].children[e]);return d(...o)}function Ot(t,e,n=0,r=0,i="center",s="left"){if(0==t.length)return _();let a=[],l=[],o=0;function h(t){let e=kt(t,r,i);a.push(e),l=[],o=0}for(let n=0;n<t.length;n++){let i=t[n],s=mt(i)[0];s>e?(l.length>0&&h(l),l.push(i),h(l)):(o+r+s>e&&h(l),l.push(i),o+=s+r)}l.length>0&&h(l);let c=At(a,n,s),u=[];for(let t=0;t<c.children.length;t++)for(let e=0;e<c.children[t].children.length;e++)u.push(c.children[t].children[e]);return d(...u)}const St=(t,e,n)=>{let r="number"==typeof e&&null!=n?function(t,e){return t.toFixed(e).replace(/\.?0+$/,"")}(e,n):e.toString();return`${z(t)} = ${r}`};var Lt,Ct,Mt;!function(t){t.locator="control_svg",t.dnd="dnd_svg",t.custom="custom_int_svg",t.button="button_svg"}(Lt||(Lt={})),function(t){t.DOCUMENT="document",t.SVG="svg"}(Ct||(Ct={}));class Tt{constructor(t,e,n,r=Ct.SVG){this.control_container_div=t,this.diagram_outer_svg=e,this.event_target=r,this.inp_variables={},this.inp_setter={},this.display_mode="svg",this.diagram_svg=void 0,this.locator_svg=void 0,this.dnd_svg=void 0,this.custom_svg=void 0,this.button_svg=void 0,this.locatorHandler=void 0,this.dragAndDropHandler=void 0,this.buttonHandler=void 0,this.draw_function=t=>{},this.display_precision=5,this.intervals={},this.registeredEventListenerRemoveFunctions=[],this.single_int_mode=!1,null!=n&&(this.inp_variables=n)}draw(){var t,e;this.draw_function(this.inp_variables,this.inp_setter),null===(t=this.locatorHandler)||void 0===t||t.setViewBox(),null===(e=this.dragAndDropHandler)||void 0===e||e.setViewBox(),Nt(this.custom_svg,this.diagram_svg),Nt(this.button_svg,this.diagram_svg)}set(t,e){this.inp_setter[t](e)}get(t){return this.inp_variables[t]}label(t,e,n=St){let r=document.createElement("div");r.classList.add("diagramatics-label"),r.innerHTML=n(t,e,this.display_precision),this.inp_variables[t]=e;this.inp_setter[t]=e=>{this.inp_variables[t]=e,r.innerHTML=n(t,e,this.display_precision)};let i=document.createElement("div");i.classList.add("diagramatics-label-container"),i.appendChild(r),this.control_container_div.appendChild(i)}locator_draw(){var t;null===(t=this.locatorHandler)||void 0===t||t.setViewBox()}locator_initial_draw(){var t;null===(t=this.locatorHandler)||void 0===t||t.setViewBox()}drag_and_drop_initial_draw(){this.dnd_initial_draw()}dnd_initial_draw(){var t,e;null===(t=this.dragAndDropHandler)||void 0===t||t.setViewBox(),null===(e=this.dragAndDropHandler)||void 0===e||e.drawSvg()}registerEventListener(t,e,n,r){t.addEventListener(e,n,r);this.registeredEventListenerRemoveFunctions.push((()=>t.removeEventListener(e,n)))}removeRegisteredEventListener(){this.registeredEventListenerRemoveFunctions.forEach((t=>t())),this.registeredEventListenerRemoveFunctions=[]}get_svg_element(t,e=!1){var n;if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let r;for(let e in this.diagram_outer_svg.children){let n=this.diagram_outer_svg.children[e];n instanceof SVGSVGElement&&n.getAttribute("meta")==t&&(r=n)}return this.single_int_mode&&e&&null!=r&&(null===(n=r.remove)||void 0===n||n.call(r),r=void 0),null==r&&(r=document.createElementNS("http://www.w3.org/2000/svg","svg"),r.setAttribute("meta",t),r.setAttribute("width","100%"),r.setAttribute("height","100%"),this.isTargetingDocument()&&(r.style.overflow="visible"),this.diagram_outer_svg.appendChild(r)),r}get_diagram_svg(){let t=this.get_svg_element("diagram_svg");return this.diagram_svg=t,t}isTargetingDocument(){return this.event_target==Ct.DOCUMENT}locator(t,e,n,r="blue",i,s=!0,l){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");this.inp_variables[t]=e;let o=this.get_diagram_svg(),h=this.get_svg_element(Lt.locator,!this.locator_svg);if(this.locator_svg=h,null==this.locatorHandler){let t=new zt(h,o);this.locatorHandler=t;const e=this.isTargetingDocument()?document:this.diagram_outer_svg;this.registerEventListener(e,"mousemove",(e=>{t.drag(e)})),this.registerEventListener(e,"mouseup",(e=>{t.endDrag(e)})),this.registerEventListener(e,"touchmove",(e=>{t.drag(e)})),this.registerEventListener(e,"touchend",(e=>{t.endDrag(e)})),this.registerEventListener(e,"touchcancel",(e=>{t.endDrag(e)}))}this.locatorHandler.registerCallback(t,((e,n=!0)=>{this.inp_variables[t]=e,l&&n&&l(t,e),n&&this.draw()}));let c,u=this.locatorHandler.create_locator_circle_pointer_svg(t,n,e,r,s);if(s){let t=u.getElementsByClassName("diagramatics-locator-blink");for(let e=0;e<t.length;e++)this.locatorHandler.addBlinkingCircleOuter(t[e])}if(this.registerEventListener(u,"mousedown",(e=>{this.locatorHandler.startDrag(e,t,u)})),this.registerEventListener(u,"touchstart",(e=>{this.locatorHandler.startDrag(e,t,u)})),i){if(i.type!=a.Polygon&&i.type!=a.Curve)throw Error("Track diagram must be a polygon or curve");if(null==i.path)throw Error("diagram {diagtam.type} must have a path");let t=i.path.points;c=e=>{let n=Dt(e,t);return u.setAttribute("transform",`translate(${n.x},${-n.y})`),n}}else c=t=>(u.setAttribute("transform",`translate(${t.x},${-t.y})`),t);this.locatorHandler.registerSetter(t,c),this.inp_setter[t]=c;let d=c(e);this.locatorHandler.setPos(t,d)}locator_custom(t,e,n,r,i=!0,s,l){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");this.inp_variables[t]=e;let o=this.get_diagram_svg(),h=this.get_svg_element(Lt.locator,!this.locator_svg);if(this.locator_svg=h,null==this.locatorHandler){let t=new zt(h,o);this.locatorHandler=t;const e=this.isTargetingDocument()?document:this.diagram_outer_svg;this.registerEventListener(e,"mousemove",(e=>{t.drag(e)})),this.registerEventListener(e,"mouseup",(e=>{t.endDrag(e)})),this.registerEventListener(e,"touchmove",(e=>{t.drag(e)})),this.registerEventListener(e,"touchend",(e=>{t.endDrag(e)})),this.registerEventListener(e,"touchcancel",(e=>{t.endDrag(e)}))}this.locatorHandler.registerCallback(t,((e,n=!0)=>{this.inp_variables[t]=e,s&&n&&s(t,e),n&&this.draw()}));let c,u=this.locatorHandler.create_locator_diagram_svg(t,n,i);if(this.registerEventListener(u,"mousedown",(e=>{this.locatorHandler.startDrag(e,t,u)})),this.registerEventListener(u,"touchstart",(e=>{this.locatorHandler.startDrag(e,t,u)})),l&&this.registerEventListener(u,"contextmenu",(e=>{e.preventDefault(),l(t)})),r){if(r.type!=a.Polygon&&r.type!=a.Curve)throw Error("Track diagram must be a polygon or curve");if(null==r.path)throw Error("diagram {diagtam.type} must have a path");let t=r.path.points;c=e=>{let n=Dt(e,t);return u.setAttribute("transform",`translate(${n.x},${-n.y})`),n}}else c=t=>(u.setAttribute("transform",`translate(${t.x},${-t.y})`),t);this.locatorHandler.registerSetter(t,c),this.inp_setter[t]=c;let d=c(e);this.locatorHandler.setPos(t,d)}slider(t,e=0,n=100,r=50,i=-1,s=1.5,a=St){-1==i&&(i=(n-e)/100),this.inp_variables[t]=r;let l=document.createElement("div");l.classList.add("diagramatics-label"),l.innerHTML=a(t,r,this.display_precision);const o=(e,n=!0)=>{this.inp_variables[t]=e,l.innerHTML=a(t,e,this.display_precision),n&&this.draw()};let h=function(t,e=0,n=100,r=50,i){let s=document.createElement("input");return s.type="range",s.min=e.toString(),s.max=n.toString(),s.value=r.toString(),s.step=i.toString(),s.oninput=()=>{let e=s.value;t(parseFloat(e))},s.classList.add("diagramatics-slider"),s}(o,e,n,r,i);this.inp_setter[t]=t=>{h.value=t.toString(),o(t,!1)};const c=1e3*s/((n-e)/i);let u=document.createElement("button"),d=document.createElement("div");d.classList.add("diagramatics-slider-playbutton-symbol"),u.appendChild(d),u.classList.add("diagramatics-slider-playbutton"),u.onclick=()=>{null==this.intervals[t]?(u.classList.add("paused"),this.intervals[t]=setInterval((()=>{let t=parseFloat(h.value);t+=i,t=(t-e)%(n-e)+e,h.value=t.toString(),o(t)}),c)):(u.classList.remove("paused"),clearInterval(this.intervals[t]),this.intervals[t]=void 0)};let g=document.createElement("div");g.classList.add("diagramatics-slider-leftcontainer"),g.appendChild(document.createElement("br")),g.appendChild(u);let p=document.createElement("div");p.classList.add("diagramatics-slider-rightcontainer"),p.appendChild(l),p.appendChild(h);let f=document.createElement("div");f.classList.add("diagramatics-slider-container"),f.appendChild(g),f.appendChild(p),this.control_container_div.appendChild(f)}init_drag_and_drop(){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let t=this.get_diagram_svg(),e=this.get_svg_element(Lt.dnd,!this.dnd_svg);if(this.dnd_svg=e,null==this.dragAndDropHandler){let n=new jt(e,t);this.dragAndDropHandler=n;const r=this.isTargetingDocument()?document:this.diagram_outer_svg;this.registerEventListener(r,"mousemove",(t=>{n.drag(t)})),this.registerEventListener(r,"mouseup",(t=>{n.endDrag(t)})),this.registerEventListener(r,"touchmove",(t=>{n.drag(t)})),this.registerEventListener(r,"touchend",(t=>{n.endDrag(t)})),this.registerEventListener(r,"touchcancel",(t=>{n.endDrag(t)}))}}dnd_container(t,e,n,r){var i;this.init_drag_and_drop(),null===(i=this.dragAndDropHandler)||void 0===i||i.add_container(t,e,n,r)}dnd_draggable_to_container(t,e,n,r){if(this.init_drag_and_drop(),null==this.dragAndDropHandler)throw Error("dragAndDropHandler in Interactive class is undefined");this.inp_variables[t]=e.origin,this.dragAndDropHandler.add_draggable_to_container(t,e,n);this.dragAndDropHandler.registerCallback(t,((e,i=!0)=>{this.inp_variables[t]=e,r&&r(t,n),i&&this.draw()}))}dnd_draggable(t,e,n,r){if(this.init_drag_and_drop(),null==this.dragAndDropHandler)throw Error("dragAndDropHandler in Interactive class is undefined");this.inp_variables[t]=e.origin,this.dragAndDropHandler.add_draggable_with_container(t,e,n);this.dragAndDropHandler.registerCallback(t,((e,n=!0)=>{this.inp_variables[t]=e,r&&r(t,e),n&&this.draw()}))}dnd_register_drop_outside_callback(t){var e;this.init_drag_and_drop(),null===(e=this.dragAndDropHandler)||void 0===e||e.register_dropped_outside_callback(t)}dnd_register_move_validation_function(t){var e;this.init_drag_and_drop(),null===(e=this.dragAndDropHandler)||void 0===e||e.register_move_validation_function(t)}dnd_move_to_container(t,e){var n;null===(n=this.dragAndDropHandler)||void 0===n||n.try_move_draggable_to_container(t,e)}get_dnd_data(){var t,e;return null!==(e=null===(t=this.dragAndDropHandler)||void 0===t?void 0:t.getData())&&void 0!==e?e:[]}set_dnd_data(t){var e;null===(e=this.dragAndDropHandler)||void 0===e||e.setData(t)}get_dnd_container_content_size(t){return this.dragAndDropHandler?this.dragAndDropHandler.get_container_content_size(t):[NaN,NaN]}set_dnd_content_sort(t){this.dragAndDropHandler&&(this.dragAndDropHandler.sort_content=t)}remove_dnd_draggable(t){var e;null===(e=this.dragAndDropHandler)||void 0===e||e.remove_draggable(t)}remove_locator(t){var e;null===(e=this.locatorHandler)||void 0===e||e.remove(t)}remove_button(t){var e;null===(e=this.buttonHandler)||void 0===e||e.remove(t)}custom_object(t,e,n){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let r=this.get_diagram_svg(),i=this.get_svg_element(Lt.custom,!this.custom_svg),s=document.createElementNS("http://www.w3.org/2000/svg","svg");return K(s,s,n,!0,!1,W(r)),s.setAttribute("overflow","visible"),s.setAttribute("class",e.join(" ")),s.setAttribute("id",t),i.setAttribute("viewBox",r.getAttribute("viewBox")),i.setAttribute("preserveAspectRatio",r.getAttribute("preserveAspectRatio")),i.style.overflow="visible",i.appendChild(s),this.custom_svg=i,s}custom_object_g(t,e,n){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let r=this.get_diagram_svg(),i=this.get_svg_element(Lt.custom,!this.custom_svg),s=document.createElementNS("http://www.w3.org/2000/svg","g");return K(i,s,n,!0,!1,W(r)),s.setAttribute("overflow","visible"),s.setAttribute("class",e.join(" ")),s.setAttribute("id",t),i.setAttribute("viewBox",r.getAttribute("viewBox")),i.setAttribute("preserveAspectRatio",r.getAttribute("preserveAspectRatio")),i.style.overflow="visible",i.appendChild(s),this.custom_svg=i,s}init_button(){if(null==this.diagram_outer_svg)throw Error("diagram_outer_svg in Interactive class is undefined");let t=this.get_diagram_svg(),e=this.get_svg_element(Lt.button,!this.button_svg);if(this.button_svg=e,null==this.buttonHandler){let n=new qt(e,t);this.buttonHandler=n}}button_toggle(t,e,n,r=!1,i){if(this.init_button(),null==this.buttonHandler)throw Error("buttonHandler in Interactive class is undefined");let s;this.inp_variables[t]=r,s=i?(e,n=!0)=>{this.inp_variables[t]=e,i(t,e),n&&this.draw()}:(e,n=!0)=>{this.inp_variables[t]=e,n&&this.draw()};let a=this.buttonHandler.try_add_toggle(t,e,n,r,s);this.inp_setter[t]=a}button_click(t,e,n,r){if(this.init_button(),null==this.buttonHandler)throw Error("buttonHandler in Interactive class is undefined");this.buttonHandler.try_add_click(t,e,n,e,(()=>{r(),this.draw()}))}button_click_hover(t,e,n,r,i){if(this.init_button(),null==this.buttonHandler)throw Error("buttonHandler in Interactive class is undefined");this.buttonHandler.try_add_click(t,e,n,r,(()=>{i(),this.draw()}))}}function Nt(t,e){null!=t&&null!=e&&(t.setAttribute("viewBox",e.getAttribute("viewBox")),t.setAttribute("preserveAspectRatio",e.getAttribute("preserveAspectRatio")))}function Dt(t,e){if(0==e.length)return t;let n=1/0,r=e[0];for(let i=0;i<e.length;i++){let s=e[i].sub(t).length_sq();s<n&&(n=s,r=e[i])}return r}function Ht(t,e){let n;return n=navigator.userAgent.toLowerCase().indexOf("firefox")>-1?function(t){let e=t.getScreenCTM(),n=t.width.baseVal.value,r=t.height.baseVal.value,i=t.viewBox.baseVal,s=n/i.width,a=r/i.height,l=Math.min(s,a),o=n/2-(i.width/2+i.x)*l,h=r/2-(i.height/2+i.y)*l;return DOMMatrix.fromMatrix(e).translate(o,h).scale(l)}(e):e.getScreenCTM(),{x:(t.x-n.e)/n.a,y:-(t.y-n.f)/n.d}}function It(t,e){return window.TouchEvent&&t instanceof TouchEvent&&(t=t.touches[0]),Ht({x:t.clientX,y:t.clientY},e)}function Rt(t,e){return It(t,e)}class zt{constructor(t,n){this.control_svg=t,this.diagram_svg=n,this.selectedElement=null,this.selectedVariable=null,this.mouseOffset=e(0,0),this.callbacks={},this.setter={},this.svg_elements={},this.blinking_circle_outers=[],this.first_touch_callback=null,this.element_pos={}}startDrag(t,n,r){this.selectedElement=r,this.selectedVariable=n,t instanceof MouseEvent&&t.preventDefault(),window.TouchEvent&&t instanceof TouchEvent&&t.preventDefault();let i=It(t,this.control_svg),s=e(i.x,i.y),a=this.element_pos[n];a&&(this.mouseOffset=a.sub(s)),this.handleBlinking()}drag(t){if(null==this.selectedElement)return;if(null==this.selectedVariable)return;t instanceof MouseEvent&&t.preventDefault(),window.TouchEvent&&t instanceof TouchEvent&&t.preventDefault();let n=It(t,this.control_svg),r=e(n.x,n.y).add(this.mouseOffset);this.element_pos[this.selectedVariable]=r,null!=this.setter[this.selectedVariable]&&(r=this.setter[this.selectedVariable](r)),null!=this.selectedVariable&&(null!=this.callbacks[this.selectedVariable]&&this.callbacks[this.selectedVariable](r),this.setViewBox())}setViewBox(){this.control_svg.setAttribute("viewBox",this.diagram_svg.getAttribute("viewBox")),this.control_svg.setAttribute("preserveAspectRatio",this.diagram_svg.getAttribute("preserveAspectRatio"))}endDrag(t){this.selectedElement=null,this.selectedVariable=null}remove(t){var e;this.selectedVariable==t&&(this.selectedElement=null,this.selectedVariable=null),delete this.callbacks[t],delete this.setter[t],null===(e=this.svg_elements[t])||void 0===e||e.remove(),delete this.svg_elements[t],delete this.element_pos[t]}setPos(t,e){this.element_pos[t]=e,this.callbacks[t](e,!1)}registerCallback(t,e){this.callbacks[t]=e}registerSetter(t,e){this.setter[t]=e}addBlinkingCircleOuter(t){this.blinking_circle_outers.push(t)}handleBlinking(){if(0!=this.blinking_circle_outers.length){for(let t=0;t<this.blinking_circle_outers.length;t++)this.blinking_circle_outers[t].classList.remove("diagramatics-locator-blink");this.blinking_circle_outers=[],null!=this.first_touch_callback&&this.first_touch_callback()}}create_locator_diagram_svg(t,n,r){let i=document.createElementNS("http://www.w3.org/2000/svg","g");return K(this.control_svg,i,n.position(e(0,0)),!0,!1,W(this.diagram_svg)),i.style.cursor="pointer",i.setAttribute("overflow","visible"),r&&(i.classList.add("diagramatics-locator-blink"),this.addBlinkingCircleOuter(i)),this.svg_elements[t]?this.svg_elements[t].replaceWith(i):this.control_svg.appendChild(i),this.svg_elements[t]=i,this.element_pos[t],i}create_locator_circle_pointer_svg(t,e,n,r,i){let s=document.createElementNS("http://www.w3.org/2000/svg","g");s.setAttribute("overflow","visible"),s.style.cursor="pointer";let a=document.createElementNS("http://www.w3.org/2000/svg","circle"),l=document.createElementNS("http://www.w3.org/2000/svg","circle"),o=.4*e;return a.setAttribute("r",e.toString()),a.setAttribute("fill",N(r,T)),a.setAttribute("fill-opacity","0.3137"),a.setAttribute("stroke","none"),a.classList.add("diagramatics-locator-outer"),i&&a.classList.add("diagramatics-locator-blink"),l.setAttribute("r",o.toString()),l.setAttribute("fill",N(r,T)),l.setAttribute("stroke","none"),l.classList.add("diagramatics-locator-inner"),s.appendChild(a),s.appendChild(l),s.setAttribute("transform",`translate(${n.x},${-n.y})`),this.svg_elements[t]?this.svg_elements[t].replaceWith(s):this.control_svg.appendChild(s),this.svg_elements[t]=s,s}}!function(t){t.container="diagramatics-dnd-container",t.draggable="diagramatics-dnd-draggable",t.ghost="diagramatics-dnd-draggable-ghost"}(Mt||(Mt={}));class jt{constructor(t,e){this.dnd_svg=t,this.diagram_svg=e,this.containers={},this.draggables={},this.callbacks={},this.hoveredContainerName=null,this.draggedElementName=null,this.draggedElementGhost=null,this.dropped_outside_callback=null,this.move_validation_function=null,this.sort_content=!1,this.dom_to_id_map=new WeakMap}add_container(t,e,n,r){null==this.containers[t]?this.containers[t]={name:t,diagram:e,position:e.origin,content:[],config:null!=r?r:{type:"horizontal-uniform"},capacity:null!=n?n:1}:this.replace_container_svg(t,e,n,r)}generate_position_map(t,n,r,i){var s;const a=t[0].add(t[1]).scale(.5);switch(n.type){case"horizontal-uniform":{let n=(t[1].x-t[0].x)/r,i=t[0].x+n/2,s=a.y;return O(0,r).map((t=>e(i+n*t,s)))}case"vertical-uniform":{let n=(t[1].y-t[0].y)/r,i=a.x,s=t[1].y-n/2;return O(0,r).map((t=>e(i,s-n*t)))}case"grid":{let[i,s]=n.value,a=t[1].y-t[0].y,l=(t[1].x-t[0].x)/i,o=a/s,h=t[0].x+l/2,c=t[1].y-o/2;return O(0,r).map((t=>e(h+l*(t%i),c-o*Math.floor(t/i))))}case"vertical":{const r=e(a.x,t[1].y),s=i.map((t=>{var e,n;return null!==(n=null===(e=this.draggables[t])||void 0===e?void 0:e.diagram_size)&&void 0!==n?n:[0,0]}));return At(s.map((([t,e])=>it(t,e).mut())),n.padding).mut().move_origin("top-center").position(r).translate(e(0,-n.padding)).children.map((t=>t.origin))}case"horizontal":{const r=e(t[0].x,a.y),s=i.map((t=>{var e,n;return null!==(n=null===(e=this.draggables[t])||void 0===e?void 0:e.diagram_size)&&void 0!==n?n:[0,0]}));return kt(s.map((([t,e])=>it(t,e).mut())),n.padding).mut().move_origin("center-left").position(r).translate(e(n.padding,0)).children.map((t=>t.origin))}case"flex-row":{const r=null!==(s=n.padding)&&void 0!==s?s:0,l=t[1].x-t[0].x-2*r,o=i.map((t=>{var e,n;return null!==(n=null===(e=this.draggables[t])||void 0===e?void 0:e.diagram_size)&&void 0!==n?n:[0,0]}));let h=Ot(o.map((([t,e])=>it(t,e).mut())),l,r,r,n.vertical_alignment,n.horizontal_alignment).mut();switch(n.horizontal_alignment){case"center":h=h.move_origin("top-center").position(e(a.x,t[1].y-r));break;case"right":h=h.move_origin("top-right").position(e(t[1].x-r,t[1].y-r));break;default:h=h.move_origin("top-left").position(e(t[0].x+r,t[1].y-r))}return h.children.map((t=>t.origin))}default:return[]}}get_container_content_size(t){var e;const n=this.containers[t];if(null==n)return[NaN,NaN];const r=null!==(e=n.config.padding)&&void 0!==e?e:0,i=n.content.map((t=>{var e,n;return null!==(n=null===(e=this.draggables[t])||void 0===e?void 0:e.diagram)&&void 0!==n?n:_()})),[s,a]=mt(d(...i));return[s+2*r,a+2*r]}replace_draggable_svg(t,e){var n;let r=this.draggables[t];null!=r&&(null===(n=r.svgelement)||void 0===n||n.remove(),r.diagram=e,r.diagram_size=mt(e),this.add_draggable_svg(t,e),this.reposition_container_content(r.container))}replace_container_svg(t,e,n,r){var i;let s=this.containers[t];null!=s&&(null===(i=s.svgelement)||void 0===i||i.remove(),s.diagram=e,n&&(s.capacity=n),r&&(s.config=r),this.add_container_svg(t,e),this.reposition_container_content(t))}add_draggable_to_container(t,e,n){if(null!=this.draggables[t])return this.replace_draggable_svg(t,e),void this.move_draggable_to_container(t,n,!0);const r=mt(e);this.draggables[t]={name:t,diagram:e.mut(),diagram_size:r,position:e.origin,container:n},this.containers[n].content.push(t)}add_draggable_with_container(t,e,n){if(null!=this.draggables[t])return void this.replace_draggable_svg(t,e);let r=`_container0_${t}`;null==n&&(n=this.diagram_container_from_draggable(e)),this.add_container(r,n);const i=mt(e);this.containers[r].content.push(t),this.draggables[t]={name:t,diagram:e.mut(),diagram_size:i,position:e.origin,container:r}}remove_draggable(t){var e;for(let e in this.containers){const n=this.containers[e];n.content=n.content.filter((e=>e!=t))}null===(e=this.draggables[t].svgelement)||void 0===e||e.remove(),delete this.draggables[t]}registerCallback(t,e){this.callbacks[t]=e}register_dropped_outside_callback(t){this.dropped_outside_callback=t}register_move_validation_function(t){this.move_validation_function=t}setViewBox(){this.dnd_svg.setAttribute("viewBox",this.diagram_svg.getAttribute("viewBox")),this.dnd_svg.setAttribute("preserveAspectRatio",this.diagram_svg.getAttribute("preserveAspectRatio"))}drawSvg(){for(let t in this.containers)this.containers[t].svgelement||this.add_container_svg(t,this.containers[t].diagram);for(let t in this.draggables)this.draggables[t].svgelement||this.add_draggable_svg(t,this.draggables[t].diagram);for(let t in this.containers)this.reposition_container_content(t)}getData(){let t=[];for(let e in this.containers)t.push({container:e,content:this.containers[e].content});return t}setData(t){try{for(let e of t)for(let t of e.content)this.try_move_draggable_to_container(t,e.container,!0)}catch(t){console.error("the data is not valid")}}diagram_container_from_draggable(t){return st(...t.bounding_box()).move_origin(t.origin).strokedasharray([5])}add_container_svg(t,n){let r=document.createElementNS("http://www.w3.org/2000/svg","g");K(this.dnd_svg,r,n.position(e(0,0)),!1,!1,W(this.diagram_svg),Mt.container);let i=n.origin;r.setAttribute("transform",`translate(${i.x},${-i.y})`),r.setAttribute("class",Mt.container),this.dnd_svg.prepend(r),this.containers[t].svgelement=r,this.dom_to_id_map.set(r,t)}add_draggable_svg(t,n){let r=document.createElementNS("http://www.w3.org/2000/svg","g");K(this.dnd_svg,r,n.position(e(0,0)),!0,!1,W(this.diagram_svg),Mt.draggable);let i=n.origin;r.setAttribute("transform",`translate(${i.x},${-i.y})`),r.setAttribute("class",Mt.draggable),r.setAttribute("draggable","true"),r.onmousedown=e=>{this.draggedElementName=t,this.startDrag(e)},r.ontouchstart=e=>{this.draggedElementName=t,this.startDrag(e)},this.dnd_svg.append(r),this.draggables[t].svgelement=r,this.dom_to_id_map.set(r,t)}reposition_container_content(t){var e,n,r,i;let s=this.containers[t];if(null==s)return;this.sort_content?s.content.sort():(null===(e=s.config)||void 0===e?void 0:e.sorting_function)&&s.content.sort(s.config.sorting_function);const a=null!==(n=s.config.custom_region_box)&&void 0!==n?n:s.diagram.bounding_box(),l=this.generate_position_map(a,s.config,s.capacity,s.content);for(let t=0;t<s.content.length;t++){let e=this.draggables[s.content[t]],n=null!==(r=l[t])&&void 0!==r?r:s.diagram.origin;e.diagram=e.diagram.position(n),e.position=n,null===(i=e.svgelement)||void 0===i||i.setAttribute("transform",`translate(${n.x},${-n.y})`)}}remove_draggable_from_container(t,e){this.containers[e].content=this.containers[e].content.filter((e=>e!=t))}move_draggable_to_container(t,e,n=!1){let r=this.draggables[t];if(null==r)return;if(r.container==e)return;let i=this.containers[e],s=r.container;if(this.remove_draggable_from_container(t,s),r.container=e,i.content.push(t),this.reposition_container_content(e),this.reposition_container_content(s),n)return;let a=this.draggables[t];this.callbacks[a.name](a.position)}try_move_draggable_to_container(t,e,n=!1){if(this.move_validation_function){if(!this.move_validation_function(t,e))return}let r=this.draggables[t],i=this.containers[e];if(i.content.length+1<=i.capacity)this.move_draggable_to_container(t,e,n);else if(1==i.capacity){let s=r.container,a=i.content[0];this.move_draggable_to_container(t,e,!0),this.move_draggable_to_container(a,s,n)}}startDrag(t){t instanceof MouseEvent&&t.preventDefault(),window.TouchEvent&&t instanceof TouchEvent&&t.preventDefault(),this.hoveredContainerName=null,this.reset_hovered_class();let e=this.dnd_svg.getElementsByClassName(Mt.ghost);for(let t=0;t<e.length;t++)e[t].remove();if(null==this.draggedElementName)return;let n=this.draggables[this.draggedElementName];null!=n.svgelement&&(n.svgelement.classList.add("picked"),this.draggedElementGhost=n.svgelement.cloneNode(!0),this.draggedElementGhost.style.pointerEvents="none",this.draggedElementGhost.setAttribute("opacity","0.5"),this.draggedElementGhost.setAttribute("class",Mt.ghost),this.dnd_svg.append(this.draggedElementGhost))}get_dnd_element_data_from_evt(t){let e=null;if(window.TouchEvent&&t instanceof TouchEvent){let n=t.touches[0];e=document.elementFromPoint(n.clientX,n.clientY)}else{const n=t;e=document.elementFromPoint(n.clientX,n.clientY)}if(null==e)return null;if("tspan"==e.localName&&(e=e.parentElement),null==e)return null;let n=e.getAttribute("_dg_tag");if(null==n)return null;if(n==Mt.container){let t=e.parentElement;if(null==t)return null;let n=this.dom_to_id_map.get(t);return null==n?null:{name:n,type:Mt.container}}if(n==Mt.draggable){let t=e.parentElement;if(null==t)return null;let n=this.dom_to_id_map.get(t);return null==n?null:{name:n,type:Mt.draggable}}return null}drag(t){var e,n,r;if(null==this.draggedElementName)return;if(null==this.draggedElementGhost)return;t instanceof MouseEvent&&t.preventDefault(),window.TouchEvent&&t instanceof TouchEvent&&t.preventDefault(),this.reset_hovered_class();let i=this.get_dnd_element_data_from_evt(t);null==i?this.hoveredContainerName=null:i.type==Mt.container?(this.hoveredContainerName=i.name,null===(e=this.containers[i.name].svgelement)||void 0===e||e.classList.add("hovered")):i.type==Mt.draggable&&(this.hoveredContainerName=null===(n=this.draggables[i.name])||void 0===n?void 0:n.container,null===(r=this.draggables[i.name].svgelement)||void 0===r||r.classList.add("hovered"));let s=It(t,this.dnd_svg);this.draggedElementGhost.setAttribute("transform",`translate(${s.x},${-s.y})`)}endDrag(t){null!=this.hoveredContainerName&&null!=this.draggedElementName&&this.try_move_draggable_to_container(this.draggedElementName,this.hoveredContainerName),null==this.hoveredContainerName&&null!=this.draggedElementName&&null!=this.dropped_outside_callback&&this.dropped_outside_callback(this.draggedElementName),this.draggedElementName=null,this.hoveredContainerName=null,this.reset_hovered_class(),this.reset_picked_class(),null!=this.draggedElementGhost&&(this.draggedElementGhost.remove(),this.draggedElementGhost=null)}reset_hovered_class(){var t,e;for(let e in this.containers)null===(t=this.containers[e].svgelement)||void 0===t||t.classList.remove("hovered");for(let t in this.draggables)null===(e=this.draggables[t].svgelement)||void 0===e||e.classList.remove("hovered")}reset_picked_class(){var t;for(let e in this.draggables)null===(t=this.draggables[e].svgelement)||void 0===t||t.classList.remove("picked")}}class qt{constructor(t,e){this.button_svg=t,this.diagram_svg=e,this.states={},this.svg_g_element={},this.touchdownName=null}remove(t){delete this.states[t];const[e,n]=this.svg_g_element[t];null==e||e.remove(),null==n||n.remove(),delete this.svg_g_element[t]}try_add_toggle(t,e,n,r,i){if(null!=this.svg_g_element[t]){let[e,n,r]=this.svg_g_element[t];e.remove(),n.remove()}return this.add_toggle(t,e,n,r,i)}add_toggle(t,e,n,r,i){let s=document.createElementNS("http://www.w3.org/2000/svg","g");K(this.button_svg,s,n,!0,!1,W(this.diagram_svg)),s.setAttribute("overflow","visible"),s.style.cursor="pointer";let a=document.createElementNS("http://www.w3.org/2000/svg","g");K(this.button_svg,a,e,!0,!1,W(this.diagram_svg)),a.setAttribute("overflow","visible"),a.style.cursor="pointer",this.button_svg.appendChild(s),this.button_svg.appendChild(a),this.svg_g_element[t]=[a,s,void 0],this.states[t]=r;const l=t=>{a.setAttribute("display",t?"block":"none"),s.setAttribute("display",t?"none":"block")};l(this.states[t]);const o=(e,n=!0)=>{this.states[t]=e,i(this.states[t],n),l(this.states[t])};a.onclick=t=>{t.preventDefault(),o(!1)},s.onclick=t=>{t.preventDefault(),o(!0)},a.ontouchstart=e=>{e.preventDefault(),this.touchdownName=t},s.ontouchstart=e=>{e.preventDefault(),this.touchdownName=t},a.ontouchend=()=>{this.touchdownName==t&&o(!1),this.touchdownName=null},s.ontouchend=()=>{this.touchdownName==t&&o(!0),this.touchdownName=null};return t=>{o(t,!1)}}try_add_click(t,e,n,r,i){if(null!=this.svg_g_element[t]){let[e,n,r]=this.svg_g_element[t];e.remove(),n.remove(),null==r||r.remove()}this.add_click(t,e,n,r,i)}add_click(t,e,n,r,i){let s=document.createElementNS("http://www.w3.org/2000/svg","g");K(this.button_svg,s,e,!0,!1,W(this.diagram_svg)),s.setAttribute("overflow","visible"),s.style.cursor="pointer";let a=document.createElementNS("http://www.w3.org/2000/svg","g");K(this.button_svg,a,n,!0,!1,W(this.diagram_svg)),a.setAttribute("overflow","visible"),a.style.cursor="pointer";let l=document.createElementNS("http://www.w3.org/2000/svg","g");K(this.button_svg,l,r,!0,!1,W(this.diagram_svg)),l.setAttribute("overflow","visible"),l.style.cursor="pointer",this.button_svg.appendChild(s),this.button_svg.appendChild(a),this.button_svg.appendChild(l),this.svg_g_element[t]=[s,a,l];const o=(t,e)=>{s.setAttribute("display",t||e?"none":"block"),a.setAttribute("display",t?"block":"none"),l.setAttribute("display",e&&!t?"block":"none")};o(!1,!1);let h=!1,c=!1;const u=()=>{o(h,c)};s.onmousedown=e=>{e.preventDefault(),this.touchdownName=t,h=!0,u()},s.onmouseup=t=>{t.preventDefault(),this.touchdownName=null},s.onmouseenter=t=>{c=!0,u()},s.onmouseleave=t=>{u()},a.onmouseleave=t=>{c=!1,h=!1,u()},a.onmousedown=e=>{e.preventDefault(),this.touchdownName=t},a.onmouseup=e=>{this.touchdownName==t&&i(),this.touchdownName=null,h=!1,u()},l.onmousedown=e=>{e.preventDefault(),this.touchdownName=t,h=!0,u()},l.onmouseup=t=>{t.preventDefault(),this.touchdownName=null},l.onmouseleave=t=>{c=!1,u()},s.ontouchstart=e=>{e.preventDefault(),this.touchdownName=t,h=!0,u()},s.ontouchend=e=>{this.touchdownName==t&&i(),this.touchdownName=null,h=!1,u()},a.ontouchstart=e=>{e.preventDefault(),this.touchdownName=t,h=!0,u()},a.ontouchend=e=>{this.touchdownName==t&&i(),this.touchdownName=null,h=!1,u()}}}function Bt(t){return function e(n){if(n.type==a.Polygon||n.type==a.Curve)return t(n);if(n.type==a.Diagram)return n.children=n.children.map((t=>e(t))),n;if(n.type==a.Text||n.type==a.MultilineText)return n;throw new Error("Unreachable, unknown diagram type : "+n.type)}}function Pt(t){return Bt((function(e){if(null==e.path)return e;let n=(e.type==a.Curve?A(0,1,t):E(0,1,t)).map((t=>e.parametric_point(t)));return e.path=new u(n),e}))}function Gt(t,e,r){let[i,s,a]=e,l=i.sub(s).normalize(),o=a.sub(s).normalize(),h=Math.abs((l.angle()-o.angle())%Math.PI),c=t/Math.tan(h/2),u=i.sub(s).length(),d=a.sub(s).length();c=Math.min(c,u/2,d/2),t=c*Math.tan(h/2);let g=s.add(l.scale(c)),p=s.add(o.scale(c)),f=Math.sqrt(t*t+c*c),_=s.add(l.add(o).normalize().scale(f)),m=g.sub(_).angle(),b=p.sub(_).angle(),v=b+2*Math.PI,y=b-2*Math.PI,x=Math.abs(m-b);return Math.abs(m-v)<x&&(b=v),Math.abs(m-y)<x&&(b=y),A(m,b,r).map((e=>_.add(n(e).scale(t))))}var Ft,Vt=Object.freeze({__proto__:null,add_arrow:function(t,e=!1){return Bt((function(n){if(null==n.path)return n;let r=e?n.path.points[0]:n.path.points[n.path.points.length-1];return d(n,dt(e?n.path.points[1]:n.path.points[n.path.points.length-2],r,t)).clone_style_from(n)}))},arrowhead_replace:function(t){return function(e){return e.apply_to_tagged_recursive(s.ARROW_HEAD,(e=>{let n=function(t){var e;if(!t.contain_tag(s.ARROW_HEAD))return NaN;let n=null===(e=t.path)||void 0===e?void 0:e.points;if(null==n)return NaN;if(3!=n.length)return NaN;let r=n[0],i=n[1],a=n[2],l=i.add(a).scale(.5);return r.sub(l).angle()}(e);return t.copy().rotate(n).position(e.origin)}))}},resample:Pt,round_corner:function(t=1,e,n=40){return 0==t?t=>t:("number"==typeof t&&(t=[t]),Bt((function(r){if(null==r.path)return r;let i=O(0,r.path.points.length);null==e&&(e=i),e=e.filter((t=>i.includes(t))),t=k(t,e.length);let s=[];for(let i=0;i<r.path.points.length;i++){let a=i;if(!e.includes(a)){s.push(r.path.points[i]);continue}let l=(a-1+r.path.points.length)%r.path.points.length,o=(a+1)%r.path.points.length,h=r.path.points[l],c=r.path.points[i],u=r.path.points[o],d=Gt(t[e.indexOf(a)],[h,c,u],n);s=s.concat(d)}return r.path=new u(s),r})))},slicepath:function(t,e,n=100){t>e&&([t,e]=[e,t]),t<0&&(t=0),e>1&&(e=1);let r=Math.floor(n/(e-t));return Bt((function(n){if(null==n.path)return n;let i=n.apply(Pt(r));if(null==i.path)return n;let s=i.path.points.slice(Math.floor(t*r),Math.floor(e*r)+1);return i.path=new u(s),i}))},subdivide:function(t=100){return Bt((function(n){if(null==n.path)return n;let r=[];for(let i=0;i<n.path.points.length;i++){let s=(i+1)%n.path.points.length,a=n.path.points[i],l=n.path.points[s],o=A(a.x,l.x,t+1),h=A(a.y,l.y,t+1),c=o.map(((t,n)=>e(t,h[n])));c.pop(),r=r.concat(c)}return n.path=new u(r),n}))}});!function(t){t[t.BeforeStart=0]="BeforeStart",t[t.EqualStart=1]="EqualStart",t[t.BetweenStartAndEnd=2]="BetweenStartAndEnd",t[t.EqualEnd=3]="EqualEnd",t[t.AfterEnd=4]="AfterEnd"}(Ft||(Ft={}));class $t{pointsSame(t,e){return this.pointsSameX(t,e)&&this.pointsSameY(t,e)}pointsCompare(t,e){return this.pointsSameX(t,e)?this.pointsSameY(t,e)?0:t[1]<e[1]?-1:1:t[0]<e[0]?-1:1}}class Ut extends $t{constructor(t=1e-10){super(),this.epsilon=t}pointAboveOrOnLine(t,e,n){const r=e[0],i=e[1],s=n[0],a=n[1],l=t[0];return(s-r)*(t[1]-i)-(a-i)*(l-r)>=-this.epsilon}pointBetween(t,e,n){const r=t[1]-e[1],i=n[0]-e[0],s=t[0]-e[0],a=n[1]-e[1],l=s*i+r*a;if(l<this.epsilon)return!1;return!(l-(i*i+a*a)>-this.epsilon)}pointsSameX(t,e){return Math.abs(t[0]-e[0])<this.epsilon}pointsSameY(t,e){return Math.abs(t[1]-e[1])<this.epsilon}pointsCollinear(t,e,n){const r=t[0]-e[0],i=t[1]-e[1],s=e[0]-n[0],a=e[1]-n[1];return Math.abs(r*a-s*i)<this.epsilon}linesIntersect(t,e,n,r){const i=e[0]-t[0],s=e[1]-t[1],a=r[0]-n[0],l=r[1]-n[1],o=i*l-s*a;if(Math.abs(o)<this.epsilon)return null;const h=t[0]-n[0],c=t[1]-n[1],u=(a*c-l*h)/o,d=(i*c-s*h)/o,g=t=>t<=-this.epsilon?Ft.BeforeStart:t<this.epsilon?Ft.EqualStart:t-1<=-this.epsilon?Ft.BetweenStartAndEnd:t-1<this.epsilon?Ft.EqualEnd:Ft.AfterEnd,p=[t[0]+u*i,t[1]+u*s];return{alongA:g(u),alongB:g(d),p:p}}}class Xt{constructor(){this.nodes=[]}remove(t){const e=this.nodes.indexOf(t);e>=0&&this.nodes.splice(e,1)}getIndex(t){return this.nodes.indexOf(t)}isEmpty(){return this.nodes.length<=0}getHead(){return this.nodes[0]}removeHead(){this.nodes.shift()}insertBefore(t,e){this.findTransition(t,e).insert(t)}findTransition(t,e){var n,r;let i=0,s=this.nodes.length;for(;i<s;){const n=i+s>>1;a=this.nodes[n],e(t)-e(a)>0?s=n:i=n+1}var a;return{before:i<=0?null:null!==(n=this.nodes[i-1])&&void 0!==n?n:null,after:null!==(r=this.nodes[i])&&void 0!==r?r:null,insert:t=>(this.nodes.splice(i,0,t),t)}}}class Wt{constructor(t,e,n,r){var i;this.otherFill=null,this.id=null!==(i=null==r?void 0:r.segmentId())&&void 0!==i?i:-1,this.start=t,this.end=e,this.myFill={above:n?n.myFill.above:null,below:n?n.myFill.below:null}}}class Yt{constructor(t,e,n,r){this.status=null,this.isStart=t,this.p=e,this.seg=n,this.primary=r}}class Kt{constructor(t,e,n=null){this.events=new Xt,this.status=new Xt,this.selfIntersection=t,this.geo=e,this.log=n}compareEvents(t,e,n,r,i,s){const a=this.geo.pointsCompare(e,i);return 0!==a?a:this.geo.pointsSame(n,s)?0:t!==r?t?1:-1:this.geo.pointAboveOrOnLine(n,r?i:s,r?s:i)?1:-1}addEvent(t){this.events.insertBefore(t,(e=>e===t?0:this.compareEvents(t.isStart,t.p,t.other.p,e.isStart,e.p,e.other.p)))}divideEvent(t,e){var n;const r=new Wt(e,t.seg.end,t.seg,this.log);return null===(n=this.log)||void 0===n||n.segmentChop(t.seg,e),this.events.remove(t.other),t.seg.end=e,t.other.p=e,this.addEvent(t.other),this.addSegment(r,t.primary)}newSegment(t,e){const n=this.geo.pointsCompare(t,e);return 0===n?null:n<0?new Wt(t,e,null,this.log):new Wt(e,t,null,this.log)}addSegment(t,e){const n=new Yt(!0,t.start,t,e),r=new Yt(!1,t.end,t,e);return n.other=r,r.other=n,this.addEvent(n),this.addEvent(r),n}addRegion(t){let e,n=t[t.length-1];for(let r=0;r<t.length;r++){e=n,n=t[r];const i=this.newSegment(e,n);i&&this.addSegment(i,!0)}}compareStatus(t,e){const n=t.seg.start,r=t.seg.end,i=e.seg.start,s=e.seg.end;return this.geo.pointsCollinear(n,i,s)?this.geo.pointsCollinear(r,i,s)||this.geo.pointAboveOrOnLine(r,i,s)?1:-1:this.geo.pointAboveOrOnLine(n,i,s)?1:-1}statusFindSurrounding(t){return this.status.findTransition(t,(e=>e===t?0:-this.compareStatus(t,e)))}checkIntersection(t,e){var n;const r=t.seg,i=e.seg,s=r.start,a=r.end,l=i.start,o=i.end;null===(n=this.log)||void 0===n||n.checkIntersection(r,i);const h=this.geo.linesIntersect(s,a,l,o);if(null===h){if(!this.geo.pointsCollinear(s,a,l))return null;if(this.geo.pointsSame(s,o)||this.geo.pointsSame(a,l))return null;const n=this.geo.pointsSame(s,l),r=this.geo.pointsSame(a,o);if(n&&r)return e;const i=!n&&this.geo.pointBetween(s,l,o),h=!r&&this.geo.pointBetween(a,l,o);if(n)return h?this.divideEvent(e,a):this.divideEvent(t,o),e;i&&(r||(h?this.divideEvent(e,a):this.divideEvent(t,o)),this.divideEvent(e,s))}else h.alongA===Ft.BetweenStartAndEnd&&(h.alongB===Ft.EqualStart?this.divideEvent(t,l):h.alongB===Ft.BetweenStartAndEnd?this.divideEvent(t,h.p):h.alongB===Ft.EqualEnd&&this.divideEvent(t,o)),h.alongB===Ft.BetweenStartAndEnd&&(h.alongA===Ft.EqualStart?this.divideEvent(e,s):h.alongA===Ft.BetweenStartAndEnd?this.divideEvent(e,h.p):h.alongA===Ft.EqualEnd&&this.divideEvent(e,a));return null}calculate(t,e){var n,r,i,s,a,l,o,h;const c=[];for(;!this.events.isEmpty();){const h=this.events.getHead();if(null===(n=this.log)||void 0===n||n.vert(h.p[0]),h.isStart){null===(r=this.log)||void 0===r||r.segmentNew(h.seg,h.primary);const n=this.statusFindSurrounding(h),o=n.before,c=n.after;null===(i=this.log)||void 0===i||i.tempStatus(h.seg,!!o&&o.seg,!!c&&c.seg);const u=()=>{if(o){const t=this.checkIntersection(h,o);if(t)return t}return c?this.checkIntersection(h,c):null},d=u();if(d){if(this.selfIntersection){let t;t=null===h.seg.myFill.below||h.seg.myFill.above!==h.seg.myFill.below,t&&(d.seg.myFill.above=!d.seg.myFill.above)}else d.seg.otherFill=h.seg.myFill;null===(s=this.log)||void 0===s||s.segmentUpdate(d.seg),this.events.remove(h.other),this.events.remove(h)}if(this.events.getHead()!==h){null===(a=this.log)||void 0===a||a.rewind(h.seg);continue}if(this.selfIntersection){let e;e=null===h.seg.myFill.below||h.seg.myFill.above!==h.seg.myFill.below,h.seg.myFill.below=c?c.seg.myFill.above:t,h.seg.myFill.above=e?!h.seg.myFill.below:h.seg.myFill.below}else if(null===h.seg.otherFill){let n;if(c)if(h.primary===c.primary){if(null===c.seg.otherFill)throw new Error("otherFill is null");n=c.seg.otherFill.above}else n=c.seg.myFill.above;else n=h.primary?e:t;h.seg.otherFill={above:n,below:n}}null===(l=this.log)||void 0===l||l.status(h.seg,!!o&&o.seg,!!c&&c.seg),h.other.status=n.insert(h)}else{const t=h.status;if(null===t)throw new Error("PolyBool: Zero-length segment detected; your epsilon is probably too small or too large");const e=this.status.getIndex(t);if(e>0&&e<this.status.nodes.length-1){const t=this.status.nodes[e-1],n=this.status.nodes[e+1];this.checkIntersection(t,n)}if(null===(o=this.log)||void 0===o||o.statusRemove(t.seg),this.status.remove(t),!h.primary){if(!h.seg.otherFill)throw new Error("otherFill is null");const t=h.seg.myFill;h.seg.myFill=h.seg.otherFill,h.seg.otherFill=t}c.push(h.seg)}this.events.removeHead()}return null===(h=this.log)||void 0===h||h.done(),c}}function Jt(t,e,n){const r=[];for(const i of t){const t=(i.myFill.above?8:0)+(i.myFill.below?4:0)+(i.otherFill&&i.otherFill.above?2:0)+(i.otherFill&&i.otherFill.below?1:0);if(0!==e[t]){const s=new Wt(i.start,i.end,null,n);s.myFill.above=1===e[t],s.myFill.below=2===e[t],r.push(s)}}return null==n||n.selected(r),r}class Zt{static union(t,e){return Jt(t,[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],e)}static intersect(t,e){return Jt(t,[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],e)}static difference(t,e){return Jt(t,[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0],e)}static differenceRev(t,e){return Jt(t,[0,2,1,0,0,0,1,1,0,2,0,2,0,0,0,0],e)}static xor(t,e){return Jt(t,[0,2,1,0,2,0,0,1,1,0,0,2,0,1,2,0],e)}}function Qt(t,e,n){const r=[],i=[];for(const s of t){const a=s.start,l=s.end;if(e.pointsSame(a,l)){console.warn("PolyBool: Warning: Zero-length segment detected; your epsilon is probably too small or too large");continue}null==n||n.chainStart(s);const o={index:0,matches_head:!1,matches_pt1:!1},h={index:0,matches_head:!1,matches_pt1:!1};let c=o;function u(t,e,n){return c&&(c.index=t,c.matches_head=e,c.matches_pt1=n),c===o?(c=h,!1):(c=null,!0)}for(let m=0;m<r.length;m++){const b=r[m],v=b[0],y=b[b.length-1];if(e.pointsSame(v,a)){if(u(m,!0,!0))break}else if(e.pointsSame(v,l)){if(u(m,!0,!1))break}else if(e.pointsSame(y,a)){if(u(m,!1,!0))break}else if(e.pointsSame(y,l)&&u(m,!1,!1))break}if(c===o){r.push([a,l]),null==n||n.chainNew(a,l);continue}if(c===h){null==n||n.chainMatch(o.index);const x=o.index,w=o.matches_pt1?l:a,k=o.matches_head,A=r[x];let E=k?A[0]:A[A.length-1];const O=k?A[1]:A[A.length-2],S=k?A[A.length-1]:A[0],L=k?A[A.length-2]:A[1];if(e.pointsCollinear(O,E,w)&&(k?(null==n||n.chainRemoveHead(o.index,w),A.shift()):(null==n||n.chainRemoveTail(o.index,w),A.pop()),E=O),e.pointsSame(S,w)){r.splice(x,1),e.pointsCollinear(L,S,E)&&(k?(null==n||n.chainRemoveTail(o.index,E),A.pop()):(null==n||n.chainRemoveHead(o.index,E),A.shift())),null==n||n.chainClose(o.index),i.push(A);continue}k?(null==n||n.chainAddHead(o.index,w),A.unshift(w)):(null==n||n.chainAddTail(o.index,w),A.push(w));continue}function d(t){null==n||n.chainReverse(t),r[t].reverse()}function g(t,i){const s=r[t],a=r[i];let l=s[s.length-1];const o=s[s.length-2],h=a[0],c=a[1];e.pointsCollinear(o,l,h)&&(null==n||n.chainRemoveTail(t,l),s.pop(),l=o),e.pointsCollinear(l,h,c)&&(null==n||n.chainRemoveHead(i,h),a.shift()),null==n||n.chainJoin(t,i),r[t]=s.concat(a),r.splice(i,1)}const p=o.index,f=h.index;null==n||n.chainConnect(p,f);const _=r[p].length<r[f].length;o.matches_head?h.matches_head?_?(d(p),g(p,f)):(d(f),g(f,p)):g(f,p):h.matches_head?g(p,f):_?(d(p),g(f,p)):(d(f),g(p,f))}return i}class te{constructor(){this.list=[],this.nextSegmentId=0,this.curVert=NaN}push(t,e){this.list.push({type:t,data:JSON.parse(JSON.stringify(e))})}segmentId(){return this.nextSegmentId++}checkIntersection(t,e){this.push("check",{seg1:t,seg2:e})}segmentChop(t,e){this.push("div_seg",{seg:t,p:e}),this.push("chop",{seg:t,p:e})}statusRemove(t){this.push("pop_seg",{seg:t})}segmentUpdate(t){this.push("seg_update",{seg:t})}segmentNew(t,e){this.push("new_seg",{seg:t,primary:e})}tempStatus(t,e,n){this.push("temp_status",{seg:t,above:e,below:n})}rewind(t){this.push("rewind",{seg:t})}status(t,e,n){this.push("status",{seg:t,above:e,below:n})}vert(t){t!==this.curVert&&(this.push("vert",{x:t}),this.curVert=t)}selected(t){this.push("selected",{segs:t})}chainStart(t){this.push("chain_start",{seg:t})}chainRemoveHead(t,e){this.push("chain_rem_head",{index:t,p:e})}chainRemoveTail(t,e){this.push("chain_rem_tail",{index:t,p:e})}chainNew(t,e){this.push("chain_new",{p1:t,p2:e})}chainMatch(t){this.push("chain_match",{index:t})}chainClose(t){this.push("chain_close",{index:t})}chainAddHead(t,e){this.push("chain_add_head",{index:t,p:e})}chainAddTail(t,e){this.push("chain_add_tail",{index:t,p:e})}chainConnect(t,e){this.push("chain_con",{index1:t,index2:e})}chainReverse(t){this.push("chain_rev",{index:t})}chainJoin(t,e){this.push("chain_join",{index1:t,index2:e})}done(){this.push("done",null)}}class ee{constructor(t){this.log=null,this.geo=t}buildLog(t){var e;return this.log=t?new te:null,null===(e=this.log)||void 0===e?void 0:e.list}segments(t){const e=new Kt(!0,this.geo,this.log);for(const n of t.regions)e.addRegion(n);return{segments:e.calculate(t.inverted,!1),inverted:t.inverted}}combine(t,e){const n=new Kt(!1,this.geo,this.log);for(const e of t.segments)n.addSegment(new Wt(e.start,e.end,e,this.log),!0);for(const t of e.segments)n.addSegment(new Wt(t.start,t.end,t,this.log),!1);return{combined:n.calculate(t.inverted,e.inverted),inverted1:t.inverted,inverted2:e.inverted}}selectUnion(t){return{segments:Zt.union(t.combined,this.log),inverted:t.inverted1||t.inverted2}}selectIntersect(t){return{segments:Zt.intersect(t.combined,this.log),inverted:t.inverted1&&t.inverted2}}selectDifference(t){return{segments:Zt.difference(t.combined,this.log),inverted:t.inverted1&&!t.inverted2}}selectDifferenceRev(t){return{segments:Zt.differenceRev(t.combined,this.log),inverted:!t.inverted1&&t.inverted2}}selectXor(t){return{segments:Zt.xor(t.combined,this.log),inverted:t.inverted1!==t.inverted2}}polygon(t){return{regions:Qt(t.segments,this.geo,this.log),inverted:t.inverted}}union(t,e){const n=this.segments(t),r=this.segments(e),i=this.combine(n,r),s=this.selectUnion(i);return this.polygon(s)}intersect(t,e){const n=this.segments(t),r=this.segments(e),i=this.combine(n,r),s=this.selectIntersect(i);return this.polygon(s)}difference(t,e){const n=this.segments(t),r=this.segments(e),i=this.combine(n,r),s=this.selectDifference(i);return this.polygon(s)}differenceRev(t,e){const n=this.segments(t),r=this.segments(e),i=this.combine(n,r),s=this.selectDifferenceRev(i);return this.polygon(s)}xor(t,e){const n=this.segments(t),r=this.segments(e),i=this.combine(n,r),s=this.selectXor(i);return this.polygon(s)}}const ne=new ee(new Ut);function re(t){var e,n;return{regions:[(null!==(n=null===(e=t.path)||void 0===e?void 0:e.points)&&void 0!==n?n:[]).map((t=>[t.x,t.y]))],inverted:!1}}function ie(t){const n=t.regions.map((t=>f(t.map((t=>e(t[0],t[1]))))));return n.length<1?_():1==n.length?n[0]:d(...n)}var se,ae=Object.freeze({__proto__:null,difference:function(t,e,n){const r=n?new ee(new Ut(n)):ne,i=re(t),s=re(e);return ie(r.difference(i,s))},intersect:function(t,e,n){const r=n?new ee(new Ut(n)):ne,i=re(t),s=re(e);return ie(r.intersect(i,s))},union:function(t,e,n){const r=n?new ee(new Ut(n)):ne,i=re(t),s=re(e);return ie(r.union(i,s))},xor:function(t,e,n){const r=n?new ee(new Ut(n)):ne,i=re(t),s=re(e);return ie(r.xor(i,s))}});!function(t){t.outer_shadow=function(t,e,n,r,i,s="outer-shadow",a,l,o=1){return`\n        <filter id="${s}" x="-${100*((a-1)/2)}%" y="-${100*((l-1)/2)}%" width="${100*a}%" height="${100*l}%">\n            <feMorphology operator="dilate" radius="${n*o}" in="SourceAlpha" result="dilated" />\n            <feGaussianBlur in="dilated" stdDeviation="${r*o}" />\n            <feOffset dx="${t*o}" dy="${e*o}" result="offsetblur" />\n            <feFlood flood-color="${i}" result="colorblur"/>\n            <feComposite in="colorblur" in2="offsetblur" operator="in" result="shadow" />\n            <feComposite in="shadow" in2="SourceAlpha" operator="out" result="clipped-shadow"/>\n        </filter>\n        `}}(se||(se={}));var le=Object.freeze({__proto__:null,get string_filter(){return se}});let oe={bbox:void 0,xrange:[-2,2],yrange:[-2,2],xticks:void 0,yticks:void 0,n_sample:100,ticksize:.1,headsize:.05,tick_label_offset:0};function he(t){let n=Object.assign(Object.assign({},oe),t);if(null==n.bbox){let[t,r]=n.xrange,[i,s]=n.yrange;n.bbox=[e(t,i),e(r,s)]}let[r,i]=n.bbox,[s,a]=n.xrange,[l,o]=n.yrange;return function(t){return e(r.x+(t.x-s)/(a-s)*(i.x-r.x),r.y+(t.y-l)/(o-l)*(i.y-r.y))}}let ce=he;function ue(t){let n=Object.assign(Object.assign({},oe),t);if(null==n.bbox){let[t,r]=n.xrange,[i,s]=n.yrange;n.bbox=[e(t,i),e(r,s)]}let[r,i]=n.bbox,a=r.x+(i.x-r.x)/(n.xrange[1]-n.xrange[0])*(0-n.xrange[0]),l=r.y+(i.y-r.y)/(n.yrange[1]-n.yrange[0])*(0-n.yrange[0]);return d(gt(e(r.x,l),e(i.x,l),n.headsize).append_tags(s.GRAPH_AXIS),gt(e(a,r.y),e(a,i.y),n.headsize).append_tags(s.GRAPH_AXIS)).stroke("gray").fill("gray")}function de(t){let n=Object.assign(Object.assign({},oe),t);if(null==n.bbox){let[t,r]=n.xrange,[i,s]=n.yrange;n.bbox=[e(t,i),e(r,s)]}let[r,i]=n.bbox;return d(dt(r,e(i.x,r.y),n.headsize).append_tags(s.GRAPH_AXIS),dt(r,e(r.x,i.y),n.headsize).append_tags(s.GRAPH_AXIS)).stroke("gray").fill("gray")}function ge(t){let n=Object.assign(Object.assign({},oe),t);if(null==n.bbox){let[t,r]=n.xrange,[i,s]=n.yrange;n.bbox=[e(t,i),e(r,s)]}let[r,i]=n.bbox,a=2*n.ticksize;null==n.xticks&&(n.xticks=ye(n.xrange[0],n.xrange[1],!1),n.xticks=n.xticks.filter((t=>t>n.xrange[0]&&t<n.xrange[1])));let l=(n.xticks[1]-n.xticks[0])/2,o=n.xticks[0]-l,h=he(n),c=h(e(o-l/2,0)),u=h(e(o+l/2,0)),f=u.x-c.x,_=c.add(e(1*f/3,-a/2)),m=c.add(e(2*f/3,a/2)),b=g([c,_,m,u]),v=d(p(r,c),b,dt(u,e(i.x,r.y),n.headsize)).append_tags(s.GRAPH_AXIS);return d(v,dt(r,e(r.x,i.y),n.headsize).append_tags(s.GRAPH_AXIS)).stroke("gray").fill("gray")}function pe(t,n,r){let i=Object.assign(Object.assign({},oe),r),a=i.ticksize,l=he(i)(e(t,n));return p(e(l.x,l.y+a/2),e(l.x,l.y-a/2)).stroke("gray").append_tags(s.GRAPH_TICK)}function fe(t,n,r,i){let a=pe(t,n,i),l=pt(r).move_origin_text("top-center").translate(a.get_anchor("bottom-center")).translate(e(0,-((null==i?void 0:i.tick_label_offset)||0))).textfill("gray").append_tags(s.GRAPH_TICK_LABEL);return d(a,l)}function _e(t,n,r){let i=Object.assign(Object.assign({},oe),r),a=i.ticksize,l=he(i)(e(n,t));return p(e(l.x+a/2,l.y),e(l.x-a/2,l.y)).stroke("gray").append_tags(s.GRAPH_TICK)}function me(t,n,r,i){let a=_e(t,n,i),l=pt(r).move_origin_text("center-right").translate(a.get_anchor("center-left")).translate(e(-((null==i?void 0:i.tick_label_offset)||0),0)).textfill("gray").append_tags(s.GRAPH_TICK_LABEL);return d(a,l)}function be(t){return.1<t&&t<2?1:t}function ve(t,e){let n=e-t,r=Math.floor(Math.log10(n)),i=[.1,.15,.2,.5,1].map((t=>t*Math.pow(10,r))),s=i.map((t=>Math.floor(n/t)));for(let t=0;t<s.length;t++)if(s[t]<=10)return be(i[t]);return be(i.slice(-1)[0])}function ye(t,e,n=!0){return n&&t<0&&e>0?function(t,e,n=!0){if(t>0)throw new Error("neg must be negative");if(e<0)throw new Error("pos must be positive");let r=Math.max(-t,e),i=ve(-r,r),s=Math.ceil(t/i)*i,a=Math.floor(e/i)*i,l=A(s,a,Math.floor((a-s)/i)+1),o=-Math.floor(Math.log10(i));return o>=0&&(l=l.map((t=>parseFloat(t.toFixed(o))))),n?l.filter((t=>0!=t)):l}(t,e):function(t,e){let n=ve(t,e),r=Math.round(t/n)*n,i=Math.round(e/n)*n,s=S(0,Math.round((i-r)/n)).map((t=>r+t*n)),a=-Math.floor(Math.log10(n)-1);return a>=0&&(s=s.map((t=>parseFloat(t.toFixed(a))))),s}(t,e)}function xe(t,e=0,n=!1){let r=Object.assign(Object.assign({},oe),t);return null==r.xticks&&(r.xticks=ye(r.xrange[0],r.xrange[1],0==e)),r.xticks=r.xticks.filter((t=>t>r.xrange[0]&&t<r.xrange[1])),d(...n?r.xticks.map((t=>pe(t,e,r))):r.xticks.map((t=>fe(t,e,t.toString(),r))))}function we(t,e=0,n=!1){let r=Object.assign(Object.assign({},oe),t);return null==r.yticks&&(r.yticks=ye(r.yrange[0],r.yrange[1],0==e)),r.yticks=r.yticks.filter((t=>t>r.yrange[0]&&t<r.yrange[1])),d(...n?r.yticks.map((t=>_e(t,e,r))):r.yticks.map((t=>me(t,e,t.toString(),r))))}function ke(t){let e=Object.assign(Object.assign({},oe),t),n=e.xrange[0],r=e.yrange[0];return d(de(e),xe(e,r),we(e,n))}function Ae(t){let e=Object.assign(Object.assign({},oe),t);return d(ue(e),xe(e),we(e))}function Ee(t){let n=Object.assign(Object.assign({},oe),t);if(null==n.bbox){let[t,r]=n.xrange,[i,s]=n.yrange;n.bbox=[e(t,i),e(r,s)]}let r=he(n)(e(0,0));return d(gt(e(n.bbox[0].x,r.y),e(n.bbox[1].x,r.y),n.headsize).append_tags(s.GRAPH_AXIS),xe(n,0))}function Oe(t){let n=Object.assign(Object.assign({},oe),t);if(null==n.bbox){let[t,r]=n.xrange,[i,s]=n.yrange;n.bbox=[e(t,i),e(r,s)]}let r=he(n)(e(0,0));return d(gt(e(r.x,n.bbox[0].y),e(r.x,n.bbox[1].y),n.headsize).append_tags(s.GRAPH_AXIS),we(n,0))}function Se(t){let n=Object.assign(Object.assign({},oe),t);return null==n.xticks&&(n.xticks=ye(n.xrange[0],n.xrange[1],!1)),d(...n.xticks.map((t=>p(e(t,n.yrange[0]),e(t,n.yrange[1])).transform(he(n)).stroke("gray")))).append_tags(s.GRAPH_GRID)}function Le(t){let n=Object.assign(Object.assign({},oe),t);return null==n.yticks&&(n.yticks=ye(n.yrange[0],n.yrange[1],!1)),d(...n.yticks.map((t=>p(e(n.xrange[0],t),e(n.xrange[1],t)).transform(he(n)).stroke("gray")))).append_tags(s.GRAPH_GRID)}function Ce(t){let n=Object.assign(Object.assign({},oe),t);return null==n.xticks&&(n.xticks=ye(n.xrange[0],n.xrange[1],!1)),null==n.yticks&&(n.yticks=ye(n.yrange[0],n.yrange[1],!1)),d(...n.xticks.map((t=>p(e(t,n.yrange[0]),e(t,n.yrange[1])).transform(he(n)).stroke("gray"))),...n.yticks.map((t=>p(e(n.xrange[0],t),e(n.xrange[1],t)).transform(he(n)).stroke("gray"))))}function Me(t,e){let n,r=Object.assign(Object.assign({},oe),e),[i,s]=r.xrange,[a,l]=r.yrange,o=[],h=[];for(let e=0;e<t.length;e++){let n=t[e];n.x>=i&&n.x<=s&&n.y>=a&&n.y<=l?h.push(n):(h.length>1&&o.push(h),h=[])}h.length>1&&o.push(h);let c=o.map((t=>g(t)));return n=1==c.length?c[0]:d(...c).stroke("black").fill("none"),n.transform(he(r))}function Te(t,n,r){if(t.length!=n.length)throw new Error("xdata and ydata must have the same length");return Me(t.map(((t,r)=>e(t,n[r]))),r)}function Ne(t,n){let r=Object.assign(Object.assign({},oe),n);return Me(A(...r.xrange,r.n_sample).map((n=>e(n,t(n)))),n)}function De(t,n,r,i){let s=Object.assign(Object.assign({},oe),i),a=Object.assign({},s);return a.xrange=[n,r],a.bbox=void 0,Ne(t,a).add_points([e(r,0),e(n,0)]).to_polygon().transform(he(s))}var He=Object.freeze({__proto__:null,ax:ce,axes_corner_empty:de,axes_corner_empty_xbreak:ge,axes_empty:ue,axes_transform:he,default_axes_options:oe,get_tick_numbers:ye,plot:Te,plotf:Ne,plotv:Me,under_curvef:De,xaxis:Ee,xgrid:Le,xtickmark:fe,xtickmark_empty:pe,xticks:xe,xyaxes:Ae,xycorneraxes:ke,xycorneraxes_xbreak:function(t){let e=Object.assign(Object.assign({},oe),t),n=e.xrange[0],r=e.yrange[0];return d(ge(e),xe(e,r),we(e,n))},xygrid:Ce,yaxis:Oe,ygrid:Se,ytickmark:me,ytickmark_empty:_e,yticks:we});function Ie(t,n,r=1,i){let[s,a,l]=t,o=s.sub(a),h=l.sub(a);if(null==i&&(i=e(0,0)),"number"==typeof i){i=o.normalize().add(h.normalize()).normalize().scale(i)}let c=o.angle(),u=h.angle();u<c&&(u+=2*Math.PI);let g=ct(r,u-c).rotate(c).add_points([e(0,0)]).to_polygon();return""==n||null==n?g.position(a):d(g,pt(n).translate(i)).position(a)}var Re=Object.freeze({__proto__:null,angle:Ie,angle_smaller:function(t,e,n=1,r){let[i,s,a]=t,l=i.sub(s),o=a.sub(s),h=l.angle(),c=o.angle();return c<h&&(c+=2*Math.PI),Ie(c-h>Math.PI?[a,s,i]:[i,s,a],e,n,r)},congruence_mark:function(t,n,r,i=1,s){let a=n.sub(t),l=Math.atan2(a.x,-a.y),o=t.add(n).scale(.5);s=null!=s?s:i/2;let h=[];for(let t=0;t<r;t++){let n=p(e(-i/2,t*s),e(i/2,t*s));h.push(n)}return d(...h).rotate(l).move_origin("center-center").position(o)},length:function(t,n,r,i,s,a,l=!0){s=null!=s?s:n.sub(t).length()/20,a=null!=a?a:2*i;let o=t.equals(n)?e(0,0):n.sub(t).normalize(),h=e(o.y,-o.x),c=t.add(h.scale(i)),u=n.add(h.scale(i)),g=l?p(c.sub(h.scale(s/2)),c.add(h.scale(s/2))):p(c,c.sub(h.scale(s))),f=l?p(u.sub(h.scale(s/2)),u.add(h.scale(s/2))):p(u,u.sub(h.scale(s))),_=d(p(c,u),g,f),m=t.add(n).scale(.5);return d(_,pt(r).position(m.add(h.scale(a))))},parallel_mark:function(t,n,r,i=1,s,a=.5){let l=n.sub(t),o=Math.atan2(l.x,-l.y),h=t.add(n).scale(.5);s=null!=s?s:i/2;let c=[],u=i/2*Math.cos(a);for(let t=0;t<r;t++){let n=e(0,t*s-u),r=p(e(-i/2,t*s),n),a=p(e(i/2,t*s),n);c.push(r.combine(a))}return d(...c).rotate(o).move_origin("center-center").position(h)},right_angle:function(t,n=1){let[r,i,s]=t,a=r.sub(i).normalize().scale(n).add(i),l=s.sub(i).normalize().scale(n).add(i);return g([a,e(a.x,l.y),l])},vector:function(t,n,r,i){null==r&&(r=e(0,0));let s=ut(t,i);return""==n||null==n?s:d(s,pt(n).position(t.add(r)))}});var ze=Object.freeze({__proto__:null,inclined_plane:function(t,n){return f([e(0,0),e(t,t*Math.tan(n)),e(t,0)])},spring:function(t,n,r=1,i=10,s=.5,a=100){let l=n.sub(t).angle(),o=n.sub(t).length(),h=s,c=r/h,u=(2*i+1)*Math.PI,d=(o-2*h)/u;return g(A(0,u,a).map((t=>e(d*t+h-h*Math.cos(t),c*h*Math.sin(t))))).rotate(l).translate(t)}});let je={gap:.1,ticksize:.2,bbox:[e(0,0),e(10,10)]};function qe(t,n){var r,i;let s=Object.assign(Object.assign({},je),n),a=t.length,l=Math.max(...t),o=null!==(r=s.yrange)&&void 0!==r?r:[0,l],h=null!==(i=s.bbox)&&void 0!==i?i:[e(0,0),e(10,l)];return{xrange:[-1,a],yrange:o,headsize:0,ticksize:s.ticksize,bbox:h}}var Be=Object.freeze({__proto__:null,axes_tansform:function(t,e={}){return he(qe(t,Object.assign(Object.assign({},je),e)))},default_bar_options:je,plot:function(t,n={}){let r=Object.assign(Object.assign({},je),n),i=he(qe(t,r));return d(...t.map(((t,n)=>it(1-r.gap,t).move_origin("bottom-center").position(e(Number(n),0)).transform(i))))},xaxes:function(t,n={}){let r=Object.assign(Object.assign({},je),n),i=t.length,s=he(qe(t.map((()=>1)),r));return d(p(e(-1,0),e(i,0)).transform(s).stroke("gray"),...t.map(((t,n)=>m(t).move_origin_text("top-center").position(e(Number(n),0)).transform(s).translate(e(0,-r.ticksize/2)).textfill("gray"))))},yaxes:function(t,n={}){var r;let i=Object.assign(Object.assign({},je),n),s=qe(t,i),a=s.yrange[1],l=null!==(r=i.yrange)&&void 0!==r?r:[0,a],o=he(s),h=p(e(-1,0),e(-1,l[1])).transform(o).stroke("gray");return we(s,-1).combine(h)}});var Pe,Ge=Object.freeze({__proto__:null,axis:function(t,n,r=1){return gt(e(t,0),e(n,0),r).fill("black").append_tags(s.GRAPH_AXIS)},numbered_ticks:function(t,n,r){let i=[];for(let a of t){let t=p(e(a,-n/2),e(a,n/2)).stroke("black").append_tags(s.GRAPH_TICK),l=m(a.toString()).move_origin("top-center").position(e(a,-n/2-r)).append_tags(s.GRAPH_TICK_LABEL);i.push(d(t,l))}return d(...i)},single_tick:function(t,n,r,i){let a=p(e(t,-r/2),e(t,r/2)).stroke("black").append_tags(s.GRAPH_TICK);return""==n?a:d(a,m(n).move_origin("top-center").position(e(t,-r/2-i)).append_tags(s.GRAPH_TICK_LABEL))},ticks:function(t,n){let r=[];for(let i of t){let t=p(e(i,-n/2),e(i,n/2)).stroke("black").append_tags(s.GRAPH_TICK);r.push(t)}return d(...r)}});function Fe(t,e,n,r=Pe.ROWS){let i=r==Pe.ROWS?t:L(t),a=i.length,l=Math.max(...i.map((t=>t.length)));const o=function(t){var e;let n=t.length,r=Math.max(...t.map((t=>t.length))),i=Array(n).fill(!1).map((()=>Array(r).fill(!1)));for(let s=0;s<n;s++)for(let n=0;n<r;n++){const r=t[s][n];(null==r||(null===(e=null==r?void 0:r.is_empty)||void 0===e?void 0:e.call(r)))&&(i[s][n]=!0)}return i}(t);let h=Ve(a,l,e,n,o),c=$e(h),u=[];for(let t=0;t<a;t++)for(let e=0;e<l;e++){let n=i[t][e];null!=n&&(n=n.move_origin("center-center").position(c[t][e]).append_tags(s.TABLE_CONTENT).append_tags(s.ROW_+t).append_tags(s.COL_+e),u.push(n))}let g=d(...u);return d(h,g).append_tags(s.CONTAIN_TABLE)}function Ve(t,n,r,i,a){for(;r.length<t;)r.push(r[r.length-1]);for(;i.length<n;)i.push(i[i.length-1]);let l=[],o=0;for(let h=0;h<t;h++){let t=o-r[h],c=0,u=[];for(let r=0;r<n;r++){let n=c+i[r],l=(c+n)/2,d=(o+t)/2,g=st(e(c,t),e(n,o)).move_origin(e(l,d)).append_tags(s.TABLE_CELL).append_tags(s.ROW_+h).append_tags(s.COL_+r);a[h][r]&&(g=g.append_tags(s.EMPTY_CELL)),u.push(g),c=n}l.push(d(...u)),o=t}return d(...l).append_tags(s.TABLE)}function $e(t){let e=t;if(t.tags.includes(s.CONTAIN_TABLE))for(let n of t.children)if(n.tags.includes(s.TABLE)){e=n;break}if(!e.tags.includes(s.TABLE))return[];let n=[];for(let t of e.children){let e=[];for(let n of t.children)e.push(n.origin);n.push(e)}return n}!function(t){t.ROWS="rows",t.COLUMNS="columns"}(Pe||(Pe={}));var Ue=Object.freeze({__proto__:null,empty_fixed_size:Ve,fixed_size:Fe,get_points:$e,style_cell:function t(e,n){let r=e.copy();if(e.tags.includes(s.CONTAIN_TABLE)){let e=r.children.findIndex((t=>t.tags.includes(s.TABLE))),i=t(r.children[e],n);return r.children[e]=i,r}if(!e.tags.includes(s.TABLE))return e;for(let t of n){let[e,n]=t.index,i=r.children[e].children[n];t.fill&&(i=i.fill(t.fill)),t.stroke&&(i=i.stroke(t.stroke)),t.strokewidth&&(i=i.strokewidth(t.strokewidth)),r.children[e].children[n]=i}return r},table:function(t,e=0,n=Pe.ROWS,r=0,i=0){let s=n==Pe.ROWS?t:L(t);const a=C(e);function l(t){if(null==t)return[i,r];let[e,n]=t.bounding_box();return[n.x-e.x+a[1]+a[3],n.y-e.y+a[0]+a[2]]}let o=s.length,h=Math.max(...s.map((t=>t.length))),c=Array(o).fill(r),u=Array(h).fill(i);for(let t=0;t<o;t++)for(let e=0;e<h;e++){let[n,r]=l(s[t][e]);c[t]=Math.max(c[t],r),u[e]=Math.max(u[e],n)}return Fe(t,c,u,n)}});let Xe={ticksize:.2,range:[0,1],bbox:[e(0,0),e(10,10)],orientation:"x",headsize:.05,tick_label_offset:0};function We(t){var n;let r=Object.assign(Object.assign({},Xe),t);if(r.bbox=null!==(n=r.bbox)&&void 0!==n?n:[e(0,0),e(10,10)],"x"==r.orientation){return{xrange:r.range,yrange:[r.bbox[0].y,r.bbox[1].y],xticks:r.ticks,headsize:r.headsize,ticksize:r.ticksize,bbox:r.bbox,tick_label_offset:r.tick_label_offset}}return{xrange:[r.bbox[0].x,r.bbox[1].x],yrange:r.range,yticks:r.ticks,headsize:r.headsize,ticksize:r.ticksize,bbox:r.bbox,tick_label_offset:r.tick_label_offset}}var Ye,Ke=Object.freeze({__proto__:null,axes:function(t={}){let n=Object.assign(Object.assign({},Xe),t),r=We(n),[i,s]=n.bbox;if("x"==n.orientation){return d(gt(e(i.x,0),e(s.x,0),n.headsize),xe(r,0)).stroke("gray").fill("gray")}return d(gt(e(0,i.y),e(0,s.y),n.headsize),we(r,0)).stroke("gray").fill("gray")},default_bar_options:Xe,empty_tickmarks:function(t,e={}){let n=Object.assign(Object.assign({},Xe),e),r=We(n);return"x"==n.orientation?(r.xticks=t,xe(r,0,!0)):(r.yticks=t,we(r,0,!0))},plotQ:function(t,n,r,i){let s=Object.assign(Object.assign({},Xe),i),a=he(We(s)),[l,o,h,c,u]=t,g=.8*r;if("x"==s.orientation){return d(it(c-o,r).move_origin("center-left").position(e(o,n)).transform(a),p(e(l,n-g/2),e(l,n+g/2)).transform(a),p(e(u,n-g/2),e(u,n+g/2)).transform(a),p(e(h,n-r/2),e(h,n+r/2)).transform(a),p(e(l,n),e(o,n)).transform(a),p(e(c,n),e(u,n)).transform(a))}return d(it(r,c-o).move_origin("bottom-center").position(e(n,o)).transform(a),p(e(n-g/2,l),e(n+g/2,l)).transform(a),p(e(n-g/2,u),e(n+g/2,u)).transform(a),p(e(n-r/2,h),e(n+r/2,h)).transform(a),p(e(n,l),e(n,o)).transform(a),p(e(n,c),e(n,u)).transform(a))},to_ax_options:We});function Je(t,n){let r=t.p,i=t.p.add(t.dir),s=n.p,a=n.p.add(n.dir),l=r.x,o=r.y,h=i.x,c=i.y,u=s.x,d=s.y,g=a.x,p=a.y,f=(l-h)*(d-p)-(o-c)*(u-g);return e(((l*c-o*h)*(u-g)-(l-h)*(u*p-d*g))/f,((l*c-o*h)*(d-p)-(o-c)*(u*p-d*g))/f)}function Ze(t,e){return{type:Ye.LINE,p:t,dir:e}}function Qe(t,e){return Ze(t,e.sub(t))}function tn(t,n){let[r,i]=n,s=r,a=i,l=e(s.x,a.y),o=e(a.x,s.y),h=[Je(t,Qe(l,a)),Je(t,Qe(a,o)),Je(t,Qe(o,s)),Je(t,Qe(s,l))];const c=1e-6;let u=h.filter((t=>(t=>t.x>=s.x-c&&t.x<=a.x+c&&t.y>=s.y-c&&t.y<=a.y+c)(t)));if(!(u.length<=1))return p(u[0],u[1])}!function(t){t.LINE="LINE"}(Ye||(Ye={}));var en=Object.freeze({__proto__:null,get_preview_diagram:function(n,r){let i=[],s=[],a={[Ye.LINE]:s},l=Object.keys(n);for(let e of l){let r=n[e];"number"!=typeof r&&(r instanceof t?i.push({name:e,p:r}):a[r.type].push({name:e,obj:r}))}let o=Math.min(...i.map((t=>t.p.x))),h=Math.max(...i.map((t=>t.p.x))),c=Math.min(...i.map((t=>t.p.y))),u=Math.max(...i.map((t=>t.p.y)));null==r&&(r=.1*Math.max(h-o,u-c));let g=[e(o-(r=function(t){let e="number"==typeof t?[t]:t;switch(e.length){case 0:return[0,0,0,0];case 1:return[e[0],e[0],e[0],e[0]];case 2:return[e[0],e[1],e[0],e[1]];case 3:return[e[0],e[1],e[2],e[1]];default:return[e[0],e[1],e[2],e[3]]}}(r))[0],c-r[1]),e(h+r[2],u+r[3])],p=s.map((t=>tn(t.obj,g))).filter((t=>void 0!==t)),f=.01*Math.max(g[1].x-g[0].x,g[1].y-g[0].y)*2/3;return d(...p,...i.map((t=>{let n=ht(f).translate(t.p).fill("black"),r=pt(t.name).translate(t.p.add(e(2*f,2*f))).move_origin_text("bottom-left"),i=r.copy().textfill("white").textstroke("white").textstrokewidth(10).opacity(.7);return n.combine(i,r)})))},intersect:function(t,e){if(t.type===Ye.LINE&&e.type===Ye.LINE){return[Je(t,e)]}return[]},line:Ze,line_from_angle:function(t,e){return Ze(t,n(e))},line_from_points:Qe,line_from_slope:function(t,n){return Ze(t,e(1,n))},line_intersection:Je,line_parallel_at_point:function(t,e){return Ze(e,t.dir)},line_perpendicular_at_point:function(t,n){return Ze(n,e(-t.dir.y,t.dir.x))},line_rotated_at_point:function(t,e,n){return Ze(n,t.dir.rotate(e))},point_collinear_extend_length:function(t,e,n){let r=e.sub(t).normalize();return e.add(r.scale(n))},point_collinear_fraction:function(t,e,n){let r=e.sub(t);return t.add(r.scale(n))},point_onLine_atDistance_from:function(t,e,n){let r=t.dir.normalize();return n.add(r.scale(e))},point_onLine_with_x:function(t,n){let r=t.dir.y/t.dir.x;return e(n,r*n+(t.p.y-r*t.p.x))},point_onLine_with_y:function(t,n){let r=t.dir.y/t.dir.x;return e((n-(t.p.y-r*t.p.x))/r,n)}});class nn{constructor(t,e,n=0,r=0){var i;this.diagram=t.value,this.size=mt(this.diagram),this.x=-1,this.y=n,this.tree=t;let s=null!==(i=t.children)&&void 0!==i?i:[];this.children=s.map(((t,e)=>new nn(t,this,n+1,e))),this.parent=e,this.thread=void 0,this.mod=0,this.ancestor=this,this.change=0,this.shift=0,this.number=r}left(){return this.thread?this.thread:this.children.length>0?this.children[0]:void 0}right(){return this.thread?this.thread:this.children.length>0?this.children[this.children.length-1]:void 0}lsibling(){if(this.parent)return this.number>0?this.parent.children[this.number-1]:void 0}}function rn(t,e,n){let r=ln(new nn(t,void 0),n),i=cn(r,0,0,e,0);return i<0&&an(r,-i),sn(r),r}function sn(t){t.diagram=t.diagram.position(e(t.x,t.y)),t.children.forEach(sn)}function an(t,e){t.x+=e,t.children.forEach((t=>an(t,e)))}function ln(t,e){let n=t.size[0]/2;if(0===t.children.length){let r=t.lsibling();if(r){let i=r.size[0]/2+n+e;t.x=r.x+i}else t.x=0}else{let r=t.children[0];t.children.forEach((t=>{ln(t,e),r=function(t,e,n){let r=t.lsibling();if(void 0!==r){let i=t,s=t,a=r,l=t.parent&&0!==t.number?t.parent.children[0]:void 0,o=t.mod,h=t.mod,c=a.mod,u=l.mod;for(;void 0!==(null==a?void 0:a.right())&&void 0!==(null==i?void 0:i.left());){a=a.right(),i=i.left(),l=null==l?void 0:l.left(),s=null==s?void 0:s.right(),s.ancestor=t;let r=a.size[0]/2+i.size[0]/2+n,d=a.x+c-(i.x+o)+r;if(d>0){on(hn(a,t,e),t,d),o+=d,h+=d}c+=a.mod,o+=i.mod,u+=l.mod,h+=s.mod}void 0!==a.right()&&void 0===s.right()?(s.thread=a.right(),s.mod+=c-h):(void 0!==(null==i?void 0:i.left())&&void 0===(null==l?void 0:l.left())&&(l.thread=i.left(),l.mod+=o-u),e=t)}return e}(t,r,e)})),function(t){let e=0,n=0;for(let r=t.children.length-1;r>=0;r--){let i=t.children[r];i.x+=e,i.mod+=e,n+=i.change,e+=i.shift+n}}(t);let i=(t.children[0].x+t.children[t.children.length-1].x)/2,s=t.lsibling();if(s){let r=s.size[0]/2+n+e;t.x=s.x+r,t.mod=t.x-i}else t.x=i}return t}function on(t,e,n){let r=e.number-t.number;e.change-=n/r,e.shift+=n,t.change+=n/r,e.x+=n,e.mod+=n}function hn(t,e,n){var r;return(null===(r=e.parent)||void 0===r?void 0:r.children.includes(t.ancestor))?t.ancestor:n}function cn(t,e,n,r,i){return t.x+=e,t.y=-n*r,i=Math.min(null!=i?i:t.x,t.x),t.children.forEach((s=>{i=cn(s,e+t.mod,n+1,r,i)})),i}function un(t){let e=t.diagram,n=t.children.map(un),r=t.children.map((t=>p(e.get_anchor("bottom-center"),t.diagram.get_anchor("top-center"))));return d(e,...r,...n)}var dn=Object.freeze({__proto__:null,mirror_treenode:function t(e){var n;return{value:e.value,children:(null!==(n=e.children)&&void 0!==n?n:[]).map(t).reverse()}},tree:function(t,e,n){return un(rn(t,e,n))}});function gn(t,n=10){const r=t.length;let i=t.map((t=>t.y)),s=new Array(r).fill(0),a=new Array(r).fill(0),l=new Array(r-1);for(let e=0;e<r-1;e++)l[e]=t[e+1].x-t[e].x;let o=new Array(r-1).fill(0),h=new Array(r).fill(0),c=new Array(r).fill(1),u=new Array(r).fill(0),d=new Array(r).fill(0);for(let t=1;t<r-1;t++)o[t]=3/l[t]*(i[t+1]-i[t])-3/l[t-1]*(i[t]-i[t-1]);for(let e=1;e<r-1;e++)c[e]=2*(t[e+1].x-t[e-1].x)-l[e-1]*u[e-1],u[e]=l[e]/c[e],d[e]=(o[e]-l[e-1]*d[e-1])/c[e];for(let t=r-2;t>=0;t--)h[t]=d[t]-u[t]*h[t+1],s[t]=(i[t+1]-i[t])/l[t]-l[t]*(h[t+1]+2*h[t])/3,a[t]=(h[t+1]-h[t])/(3*l[t]);let g=[];for(let l=0;l<r-1;l++)for(let r=0;r<=n;r++){let o=t[l].x+r*(t[l+1].x-t[l].x)/n,c=i[l]+s[l]*(o-t[l].x)+h[l]*Math.pow(o-t[l].x,2)+a[l]*Math.pow(o-t[l].x,3);g.push(e(o,c))}return g}var pn=Object.freeze({__proto__:null,bezier_cubic:function(t,e,n,r,i=100){const s=1/(i-1),a=Array(i);for(let l=0;l<i;l++){const i=l*s,o=t.scale((1-i)*(1-i)*(1-i)),h=e.scale(3*i*(1-i)*(1-i)),c=n.scale(3*i*i*(1-i)),u=r.scale(i*i*i);a[l]=o.add(h).add(c).add(u)}return g(a)},bezier_quadratic:function(t,e,n,r=100){const i=1/(r-1),s=Array(r);for(let a=0;a<r;a++){const r=a*i,l=t.scale((1-r)*(1-r)),o=e.scale(2*r*(1-r)),h=n.scale(r*r);s[a]=l.add(o).add(h)}return g(s)},cubic_spline:function(t,e=10){return g(gn(t,e))},curve_combine:function(...t){return g(t.map((t=>{var e,n;return null!==(n=null===(e=t.path)||void 0===e?void 0:e.points)&&void 0!==n?n:[]})).flat())},interpolate_cubic_spline:gn});var fn=Object.freeze({__proto__:null,decode:function(t){return decodeURIComponent(atob(t))},encode:function(t){return btoa(encodeURIComponent(t))}});export{c as Diagram,Tt as Interactive,u as Path,s as TAG,e as V2,n as Vdir,t as Vector2,q as _init_default_diagram_style,P as _init_default_text_diagram_style,F as _init_default_textdata,yt as align_horizontal,vt as align_vertical,Re as annotation,ct as arc,k as array_repeat,ut as arrow,dt as arrow1,gt as arrow2,ce as ax,de as axes_corner_empty,ue as axes_empty,he as axes_transform,Be as bar,ae as boolean,Ke as boxplot,ht as circle,Ht as clientPos_to_svgPos,g as curve,pn as curves,j as default_diagram_style,B as default_text_diagram_style,G as default_textdata,d as diagram_combine,Et as distribute_grid_row,xt as distribute_horizontal,kt as distribute_horizontal_and_align,Ot as distribute_variable_row,wt as distribute_vertical,At as distribute_vertical_and_align,rt as download_svg_as_png,nt as download_svg_as_svg,J as draw_to_svg,Z as draw_to_svg_element,_ as empty,fn as encoding,le as filter,en as geo_construct,bt as geometry,Rt as get_SVGPos_from_event,Y as get_tagged_svg_element,He as graph,et as handle_tex_in_svg,b as image,p as line,A as linspace,E as linspace_exc,ze as mechanics,Vt as mod,v as multiline,y as multiline_bb,Ge as numberline,Te as plot,Ne as plotf,Me as plotv,f as polygon,O as range,S as range_inc,it as rectangle,st as rectangle_corner,lt as regular_polygon,ot as regular_polygon_side,V as reset_default_styles,at as square,R as str_latex_to_unicode,z as str_to_mathematical_italic,Ue as table,m as text,pt as textvar,w as to_degree,x as to_radian,L as transpose,dn as tree,De as under_curvef,M as utils,Ee as xaxis,Le as xgrid,fe as xtickmark,pe as xtickmark_empty,xe as xticks,Ae as xyaxes,ke as xycorneraxes,Ce as xygrid,Oe as yaxis,Se as ygrid,me as ytickmark,_e as ytickmark_empty,we as yticks};
//# sourceMappingURL=diagramatics.min.js.map
